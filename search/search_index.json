{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Welcome to the g-2 Modified DAQ Manual","text":"<p>The purpose of this manual is to aid users with setup, usage, and debugging of the g-2 modified data acquisition (DAQ) system. This DAQ's purpose is to aid with various test stands across the PIONEER collaboration. Most topics are simplified to only include information needed for operating this DAQ. Some external links are provided for additional, generalized information.</p> <p>Many of the guides on this webpage are thorough, as they are aimed to give solutions to problems I've encountered. However, every system is different; there may be some additional debugging to be done on the user's end.</p>"},{"location":"#pdf-version","title":"PDF Version","text":"<p>A pdf version of this manual is automatically generated using MkDocs with pdf plugin.</p>"},{"location":"#contact","title":"Contact","text":"<p>Manual Written by Jack Carlton.  Ph.D. Candidate, Department of Physics and Astronomy, University of Kentucky.   Email: j.carlton@uky.edu  GitHub: jaca230</p> <p>Feel free to reach out with any questions, to correct mistakes, point out missing information, or otherwise. If you're familiar with mkdocs and have repository access, feel free to push your edits and credit yourself.</p> <p>Last Updated: August 6, 2024</p>"},{"location":"debugging/","title":"Debugging Common Errors","text":"<p>Below are some common errors and their solutions. This is not a complete list of all errors.</p>"},{"location":"debugging/#initialization-errors","title":"Initialization Errors","text":""},{"location":"debugging/#mch-ipmi-communication-failed","title":"MCH: IPMI Communication Failed","text":"<p>Verify the MCH is connected to the DAQ computer via 1GbE. Verify you can ping the MCH:</p> <pre><code>ping 192.168.[crate].15\n</code></pre> <p>Verify the MCH IP ODB setting is correct.</p>"},{"location":"debugging/#amc13-t1-ip-address-read-failure","title":"AMC13: T1 IP Address Read Failure","text":"<p>Verify the AMC13 is plugged into the appropriate slot (above the MCH, see the labeled crate picture). Try pinging T1 and T2 on the AMC13</p> <pre><code>ping 192.168.[crate].13\nping 192.168.[crate].14\n</code></pre> <p>If not, use ipmitool to verify the AMC13 is recognized in the crate. Try to reconfigure the AMC13.</p> <p>Note: I have seen cases where <code>ipmitool -H 192.168.[crate].15 fru print</code> will not show the AMC13, however the system still works as intended.</p>"},{"location":"debugging/#enabled-top-sfp-ports-failure","title":"Enabled Top SFP Ports Failure","text":"<p>Verify the SFP port location and FMC location ODB settings are correct. Make sure you are using SFPs (such as a Finisar SFP) and not an SFP+ (such as Avago SFP+) in the FC7 and AMC13 optical link. Verify unconnected frontends (crates) are disabled in the ODB.</p>"},{"location":"debugging/#amc13-ttc-signal-absent","title":"AMC13: TTC Signal Absent","text":"<p>Verify the SamTech Cable is appropriately connected to the FC7 and bank board. You can put these in the bank backwards, see the labeled bank image for the correct orientation. Verify the signal integrity of the 40MHz clock fed into the signal bank.</p>"},{"location":"debugging/#link01-invalid-amc13-sfp-ip-address","title":"Link01: Invalid AMC13 SFP IP Address","text":"<p>Verify the SFP IP in the ODB matches the value read in AMC13Tool2.exe using</p> <pre><code>rv 0x1c1c\n</code></pre> <p>Convert this hex value to an IP and verify it matches the ODB value.</p>"},{"location":"debugging/#amc13-initialization-failed","title":"AMC13 Initialization Failed","text":"<p>This error seems to pop up in different cases. Sometimes, it's enough to simply wait 5 minute and try running the frontends again. Another solution is to power cycle the crate.</p> <p>If you don't want to power cycle the crate, you can issue a \"cold reset\" to the AMC13:</p> <pre><code>cd $GM2DAQ_DIR/amc13/amc13_v1_2_18/dev_tools/amc13Config\n</code></pre> <p>Ensure <code>systemVars.py</code> looks correct. Then issue a cold reset:</p> <pre><code>./coldReset.py\n</code></pre> <p>Then reconfigure the AMC13; you made need to set the T1 and T2 IPs again. At the minimum you should re-initialize using AMC13Tool2.exe.</p>"},{"location":"debugging/#tcp-initialization-failed","title":"TCP initialization failed","text":"<p>Verify the 10GbE NIC is functioning and properly connected to the AMC13. Verify the 10GbE link is properly configured. For instance, in AMC13Tool2.exe</p> <pre><code>rv 0x1c1c\n</code></pre> <p>Convert this hex value to an IP and try pinging it, for instance</p> <pre><code>ping 192.168.51.1\n</code></pre> <p>If you cannot ping this IP, check your network settings for the 10GbE NIC. Verify the IP read above matches the SFP IP ODB value.</p>"},{"location":"debugging/#alarms-and-run-ending-errors","title":"Alarms and Run Ending Errors","text":""},{"location":"debugging/#alarm-ccc-run-aborted","title":"Alarm: CCC Run Aborted","text":"<p>This was a common error during g-2. At it's worst, it should occur on ~6 hour time scales. You must restart the frontends to re-initialize the crate hardware.</p>"},{"location":"debugging/#tcp_thread-break-the-tcp-thread-loop-becuase-of-a-reading-error-1","title":"tcp_thread: break the tcp thread loop becuase of a reading error -1","text":"<p>This was a common error during the 2023 test beam at PSI. This error usually occurs because the data buffer between reading in data and processing data has filled up. I.e. midas events are being created slower than events are coming in. As a result, the tcp_thread has nowhere to store incoming data and errors out.</p> <p>This error is rate dependant. One way to fix it is to simply lower the rate. However, the DAQ has been tested and run for long periods at ~5kHz. A better solution would be to minimize the use other processes running on the DAQ computer, particularly those that interact with midas. For example, the publisher is a culprit for causing delays within midas.</p>"},{"location":"hardware_overview/","title":"Hardware Documentation","text":""},{"location":"hardware_overview/#general-hardware-overview","title":"General Hardware Overview","text":""},{"location":"hardware_overview/#conceptual-diagram-one-crate-system","title":"Conceptual Diagram (One Crate System)","text":"<ul> <li>Differential signal into WFD5 (Waveform Digitizer): Differential signaling are input into Cornell's WFD5s. Data is aggregated by AMC13 on triggers.</li> <li>Trigger signal into FC7 (Flexible Controller): Provides flexible triggering, FC7 sends trigger signals over optical links to the AMC13.</li> <li>AMC13 (Advanced Mezzanine Card): Aggregates data from digitizers on a trigger and packages for sending over 10GbE (10 Gigabit Ethernet). Transfers this to the desktop for further processing.</li> <li>MCH (MicroTCA Carrier Hub): Facilitates communication between the desktop and the crate system via 1GbE Ethernet, managing system-level (crate) operations in a way.</li> <li>Desktop CPU: Processes events received from the AMC13. Data is unpacked and formed into midas events for storage.</li> <li>Meinberg: Provides precise trigger timestamps using GPS timing. This is an artifact of g-2 more than anything, were multiple disconnected systems needed to be correlated. </li> </ul>"},{"location":"hardware_overview/#labled-picture-one-crate-system","title":"Labled Picture (One Crate System)","text":""},{"location":"hardware_overview/#ipmi","title":"IPMI","text":""},{"location":"hardware_overview/#overview","title":"Overview","text":"<p>Intelligent Platform Management Interface (IPMI) is a standardized interface used for managing and monitoring computer systems. It allows for the remote management of systems independently of the operating system state or the system's power state. IPMI provides a way to manage a server using a set of standardized commands and messages that can be sent over a network or via a direct serial connection.</p>"},{"location":"hardware_overview/#features-of-ipmi","title":"Features of IPMI","text":"<ul> <li>Remote Management: Allows administrators to remotely manage systems, including power on/off, rebooting, and accessing system logs.</li> <li>Hardware Monitoring: Monitors hardware components like temperature, voltage, fans, and power supply status.</li> <li>Serial Over LAN (SOL): Provides serial console access over a network, allowing remote troubleshooting and management.</li> <li>Event Logging: Logs critical system events such as hardware failures or temperature thresholds being exceeded.</li> <li>Security: Supports user authentication, encrypted communication, and access control.</li> </ul>"},{"location":"hardware_overview/#common-ipmi-tools","title":"Common IPMI Tools","text":"<ul> <li>ipmitool: A command-line utility for managing IPMI-enabled devices. It supports a wide range of commands for sensor reading, system status checking, power control, and firmware updates. ipmitool commands are the building blocks used in many of the configuration scripts for the hardware. See ipmitool for more information.</li> </ul>"},{"location":"hardware_overview/#example-commands-using-ipmitool","title":"Example Commands Using <code>ipmitool</code>","text":"<p>1 Print Field Replaceable Unit (FRU) Information:</p> <pre><code>ipmitool -H 192.168.1.15 fru print\n</code></pre> <p>This command retrieves and prints the Field Replaceable Unit (FRU) information from the IPMI device located at IP address <code>192.168.1.15</code>.</p> <ul> <li><code>-H 192.168.1.15</code>: Specifies the IP address of the IPMI device. Replace <code>192.168.1.15</code> with the actual IP address of your IPMI device.</li> <li><code>fru print</code>: Command to retrieve and display the FRU information. FRU information includes details about hardware components that can be replaced in the system, such as part numbers and descriptions.</li> </ul> <p>2 Send Raw Command to IPMI Device:</p> <pre><code>ipmitool -I lan -H 192.168.1.15 -m 0x20 -B 0 -T 0x82 -b 7 -t 0x86 raw 0x06 0x1\n</code></pre> <p>This command sends a raw IPMI command to a device over LAN with specified parameters.</p> <ul> <li><code>-I lan</code>: Specifies the interface type (<code>lan</code> in this case), which indicates that the IPMI command will be sent over the LAN interface.</li> <li><code>-H 192.168.1.15</code>: Specifies the IP address of the IPMI device.</li> <li><code>-m 0x20</code>: Specifies the channel number to communicate with the BMC (Baseboard Management Controller). The default is usually <code>0x20</code>, but for some reason we need to specify this on some systems.</li> <li><code>-B 0</code>: Specifies the BMC instance number.</li> <li><code>-T 0x82</code>: Specifies the target address in the IPMI device. This is the MCH.</li> <li><code>-b 7</code>: Specifies the bus number.</li> <li><code>-t 0x86</code>: Specifies the target channel number. This is the device you're targeting, in this case it's FC7 in slot 11 of the microTCA crate.</li> <li><code>raw 0x06 0x1</code>: Command to send a raw IPMI command (<code>0x06 0x1</code> in this case) to the specified IPMI device. The raw command <code>0x06 0x1</code> varies based on the specific IPMI command you intend to send.</li> </ul> <p>You can read a bit more about these commands in the manuals linked in the MCH section. You can read more about ipmitool's command arguments on this webpage.</p>"},{"location":"hardware_overview/#1gbe-nic-gigabit-ethernet-network-interface-card","title":"1GbE NIC (Gigabit Ethernet Network Interface Card)","text":""},{"location":"hardware_overview/#overview_1","title":"Overview","text":"<p>These NICs are generally PCIe Cards that are \"plug and play\". They provide a 1 gigabit per second ethernet connection for the host computer.</p>"},{"location":"hardware_overview/#configuration","title":"Configuration","text":"<p>If you machine has a GUI, you may find it easier to edit network settings that way. Otherwise, you can edit settings from command line. For example for UKY's teststand we use:</p> <pre><code>nmcli connection modify enp5s0 \\\n    ipv4.addresses 192.168.1.100/16 \\\n    ipv4.method manual \\\n    connection.autoconnect yes \\\n    ipv6.method ignore\n</code></pre> <p>You may need to create a connection configuration file first if it doesn't exist. For example for UKY's teststand we use:</p> <pre><code>nmcli connection add type ethernet con-name enp5s0 ifname enp5s0\n</code></pre> <p>In particular, the <code>ipv4.addresses</code> is important. Here the port is specified to accept any traffic on the 192.168.xxx.xxx subnet. See the networking page for more details.</p>"},{"location":"hardware_overview/#10gbe-nic-10-gigabit-ethernet-network-interface-card","title":"10GbE NIC (10 Gigabit Ethernet Network Interface Card)","text":""},{"location":"hardware_overview/#overview_2","title":"Overview","text":"<p>These NICs are generally PCIe Cards that are \"plug and play\". They provide a 10 gigabit per second ethernet connection for the host computer. In our case, we use optical cables that plug into SFPs. The MTU (Maximum Transmission Unit) of the card should be 9000 or greater.</p>"},{"location":"hardware_overview/#configuration_1","title":"Configuration","text":"<p>If you machine has a GUI, you may find it easier to edit network settings that way. Otherwise, you can edit settings from command line. For example, for UKY's teststand we use these settings: </p> <pre><code>nmcli connection modify enp1s0f0 \\\n    ipv4.addresses 192.168.51.100/24 \\\n    ipv4.method manual \\\n    connection.autoconnect yes \\\n    connection.autoconnect-priority -999 \\\n    802-3-ethernet.mtu 9000 \\\n    ipv6.method ignore\n</code></pre> <p>You may need to create a connection configuration file first if it doesn't exist. For example for UKY's teststand we use:</p> <pre><code>nmcli connection add type ethernet con-name enp1s0f0 ifname enp1s0f0\n</code></pre> <p>In particular, the <code>ipv4.addresses</code> and <code>802-3-ethernet.mtu</code> sections are important. Here the port is specified to accept any traffic on the 192.168.51.xxx subnet. See the networking page for more details.</p>"},{"location":"hardware_overview/#tca-crate-micro-telecommunications-computing-architecture-crate","title":"\u00b5TCA Crate (Micro Telecommunications Computing Architecture Crate)","text":""},{"location":"hardware_overview/#overview_3","title":"Overview","text":"<p>Micro Telecommunications Computing Architecture (\u00b5TCA or MicroTCA) is a modular, high-performance architecture designed for telecommunications and other industries requiring reliable, scalable, and high-bandwidth systems. CERN employs \u00b5TCA systems for the acquisition and processing of vast amounts of data generated by particle detectors. These systems are capable of handling high-speed data streams and ensuring data integrity and accuracy.</p> <p>For our purposes, you can just view it as an electronics crate to host the MCH, FC7, and WFD5.</p>"},{"location":"hardware_overview/#configuration_2","title":"Configuration","text":"<p>The \u00b5TCA Crate should be \"plug and play\" in our case; no configuration is needed.</p>"},{"location":"hardware_overview/#mch-microtca-carrier-hub","title":"MCH (MicroTCA Carrier Hub)","text":""},{"location":"hardware_overview/#overview_4","title":"Overview","text":"<p>For our purposes, the MCH acts as a point of communication between the crate and the computer hosting the frontends. Here, we will cover specifically setting up VadaTech MCHs, however the system can also be run using N.A.T. MCH.</p>"},{"location":"hardware_overview/#wired-connections","title":"Wired Connections","text":""},{"location":"hardware_overview/#1gbe-ethernet-connection","title":"1GbE Ethernet Connection","text":"<p>The MCH should have an ethernet port labeled <code>GbE0</code> or <code>1GbE</code> (or something along those lines). Use an ethernet cable to connect this to your system's 1GbE NIC. </p> <p>See the labeled DAQ Picture 1GbE MCH in/out.</p>"},{"location":"hardware_overview/#configuration_3","title":"Configuration","text":"<p>First you should configure the 1GbE NIC if you haven't already.</p> <p>Here are some pdfs that may be be helpful:</p> <ul> <li>MCH Manual PDF</li> <li>MCH Network Configuration PDF</li> </ul>"},{"location":"hardware_overview/#changing-mch-network-settings","title":"Changing MCH Network Settings","text":"<p>Below is a stripped down version of MCH Network Configuration PDF; you can read the pdf for more details.</p> <p>1 Connect to the MCH's Linux environment</p> <p>Plug an Ethernet cable into the GbE0 port and the frontend host computer. From a terminal, run</p> <pre><code>ssh root@192.168.[crate].15\n</code></pre> <p>The password should be <code>root</code>.</p> <p>Note: If you don't know what IP the MCH has, you can try pinging a crate numbers up to 32</p> <pre><code>ping 192.168.[crate].15\n</code></pre> <p>If you still can't find the crate, you should verify your frontend host computer's ethernet port is properly configured. See the networking page for some general networking information. If that still fails, you may need to do a network scan to look for the MCH.</p> <p>Note: The error <code>Bad server host key: Invalid key length</code> may be due to OpenSSH versions &gt;7.8 (August 2018) requiring rsa keys to be at least 2048 bits. The MCH may be configured to have a key shorter than this. Dropbear (a lightweight ssh client) has no such requirement and should already be installed on the MCH. To connect via dropbear instead:</p> <pre><code>yum install dropbear\ndbclient root@192.168.2.15\n</code></pre> <p>From here, you can regenerate MCH's RSA key if you'd like, but it is not required.</p> <p>2 Remount root directory with read/write permission</p> <pre><code>mount -o remount,rw /\n</code></pre> <p>3 Edit Network Settings</p> <pre><code>vi /etc/rc.d/rc.conf\n</code></pre> <p>Note: In order to insert text properly, I had to type this command into vi first <code>:set nocompatible</code></p> <p>Change the following to reflect your network settings</p> <pre><code># net interface 1\nexport SYSCFG_IFACE1=y\nexport INTERFACE1=\"eth1\"\nexport IPADDR1=\"192.168.[crate].15\"\nexport NETMASK1=\"255.255.224.0\"\nexport BROADCAST1=\"192.168.31.255\"\nexport GATEWAY1={IP of server (i.e. the IP of the ethernet port on the frontend host computer)}\nexport NAMESERVER1=\"0.0.0.0\"\n</code></pre> <p>For example</p> <pre><code># net interface 1\nexport SYSCFG_IFACE1=y\nexport INTERFACE1=\"eth1\"\nexport IPADDR1=\"192.168.2.15\"\nexport NETMASK1=\"255.255.224.0\"\nexport BROADCAST1=\"192.168.31.255\"\nexport GATEWAY1=\"192.168.1.100\"\nexport NAMESERVER1=\"0.0.0.0\"\n</code></pre> <p>Note: For a one crate system, you can change <code>NETMASK1</code> to <code>255.255.255.0</code> if your really want. This just means the MCH can only see IPs that start with <code>192.168.[crate]</code>.</p> <p>Then run</p> <pre><code>carrier set_ip_connection -s 192.168.[crate].17 -c 192.168.[crate].18\ncarrier set_ip_connection -m 192.168.[crate].19 -M 192.168.[crate].20\n</code></pre> <p>4 Edit .xml settings</p> <p>Edit the .xml config</p> <pre><code>vi /opt/vadatech/IPMI/UTCShelf/etc/fruUTCSH.xml\n</code></pre> <p>In <code>vi</code> you can use the command <code>:/192</code> to skip to the relevant section.</p> <pre><code>&lt;IP_Connection&gt;\n    &lt;in_band&gt;eth0,eth1&lt;/in_band&gt;\n    &lt;failover&gt;eth1,eth0&lt;/failover&gt;\n    &lt;IP&gt;\n        &lt;ip_address&gt;192.168.[crate].17&lt;/ip_address&gt;\n        &lt;gw_address&gt;192.168.1.1&lt;/gw_address&gt;\n        &lt;net_mask&gt;255.255.255.0&lt;/net_mask&gt;\n    &lt;/IP&gt;\n&lt;/IP_Connection&gt;\n</code></pre> <p>Change the <code>&lt;ip_address&gt;</code>, <code>&lt;gw_address&gt;</code>, and <code>&lt;net_mask&gt;</code> to correspond with what you changed above. For example:</p> <pre><code>&lt;IP_Connection&gt;\n    &lt;in_band&gt;eth0,eth1&lt;/in_band&gt;\n    &lt;failover&gt;eth1,eth0&lt;/failover&gt;\n    &lt;IP&gt;\n        &lt;ip_address&gt;192.168.2.17&lt;/ip_address&gt;\n        &lt;gw_address&gt;192.168.1.100&lt;/gw_address&gt;\n        &lt;net_mask&gt;255.255.224.0&lt;/net_mask&gt;\n    &lt;/IP&gt;\n&lt;/IP_Connection&gt;\n</code></pre> <p>Then run</p> <pre><code>vtipmi stop\ncreateFruRepositories\n</code></pre> <p>5 Power cycle the uTCA crate</p> <p>The MicroTCA crate must then be power-cycled, and you must wait until all of the blue hot-swap lights have turned off.</p> <p>6 Set Shelf Address</p> <p>Repeat steps 1 and 2. Then run the command</p> <pre><code>set_shelf_address_info -a 192.168.[crate].17\n</code></pre> <p>7 Verify Settings Changes</p> <p>Verify the output of all the following commands looks right.</p> <pre><code>carrier get_ip_connection\n</code></pre> <pre><code>get_ip_connection\n</code></pre> <pre><code>get_shelf_address_info\n</code></pre> <pre><code>list_carriers_present\n</code></pre> <pre><code>ifconfig\n</code></pre> <p>Finally, exit the ssh connection with</p> <pre><code>exit\n</code></pre> <p>and verify you can ping the MCH on the new assigned address</p> <pre><code>ping 192.168.[crate].15\n</code></pre>"},{"location":"hardware_overview/#wfd5-waveform-digitizer","title":"WFD5 (Waveform Digitizer)","text":""},{"location":"hardware_overview/#overview_5","title":"Overview","text":"<p>The WFD5 is a AMC developed by Cornell for g-2 data digitization. Our use case it the same: to digitize the data before being processed further by the frontend host computer.</p>"},{"location":"hardware_overview/#wired-connections_1","title":"Wired Connections","text":""},{"location":"hardware_overview/#pentabus-cable-input-signal","title":"Pentabus Cable Input Signal","text":"<p>The WFD5 has a 5 channel differential signal input. Connect the differential signal to be digitized using a pentabus cable. </p> <p>See the labeled DAQ Picture WFD5 5-channel differential signal in.</p>"},{"location":"hardware_overview/#configuration_4","title":"Configuration","text":"<p>First you should configure the MCH if you haven't already.</p> <p>For most of the configuration below to work, you must have cactus installed and linked with python. There are WFD5 python configuration scripts located on the PIONEER github. Some of these scripts are written in python 2, it's easiest to manually update the syntax to be compatible with python 3. After setting up your github account, You can clone the repository with:</p> <pre><code>git clone git@github.com:PIONEER-Experiment/wfdConfig.git\n</code></pre> <p>Below are a few examples of using the configuration scripts.</p>"},{"location":"hardware_overview/#reading-ip-address","title":"Reading IP Address","text":"<pre><code>cd wfdConfig/software\npython read_addresses.py\n</code></pre> <p>This will print usage help.</p>"},{"location":"hardware_overview/#changing-ip-address","title":"Changing IP Address","text":"<pre><code>cd wfdConfig/software\npython store_ip.py\n</code></pre> <p>This will print usage help.</p> <p>You should set the IP to be in the format <code>192.168.[crate number].[slot number]</code> for the DAQ to work properly.</p> <p>You will need to power cycle (pull the black handle out and push it back in) the WFD5 to get it to take the new address.</p> <p>Then verify you can ping the address</p> <pre><code>ping 192.168.[crate].[slot]\n</code></pre>"},{"location":"hardware_overview/#reading-status","title":"Reading Status","text":"<pre><code>cd wfdConfig/software\npython read_status.py\n</code></pre> <p>This will print usage help.</p>"},{"location":"hardware_overview/#updating-firmware","title":"Updating Firmware","text":"<p>There are some instructions in the read me, you can see them on the wfdConfig github page.</p> <p>You need to set the IP before doing this.</p> <p>It will be easier if you install the DAQ software before doing this. In particular, you want the environment variable <code>BOOST_ROOT</code> declared in your shell session. Additionally, you'll want the address table located in the g-2 modified DAQ repository.</p> <p>You may be able to simply make the FC7 firmware updating tool with</p> <pre><code>cd wfdConfig/software/flash\nmake\n</code></pre> <p>If so, skip to step 4 below.</p> <p>1 Setup environment (if not already)</p> <pre><code>cd /path/to/gm2daq-modified/environment_setup/\nsource ./setup_environment.sh\ncd /path/to/wfdConfig/software/flash\n</code></pre> <p>where you replace <code>/path/to</code> with the appropriate paths.</p> <pre><code>export LD_LIBRARY_PATH=$(pwd)/lib:$LD_LIBRARY_PATH\nexport CPLUS_INCLUDE_PATH=\"$BOOST_ROOT/include:$CPLUS_INCLUDE_PATH\"\n</code></pre> <p>2 Edit makefile</p> <p>Using your favorite text editor, open the makefile</p> <pre><code>vi Makefile\n</code></pre> <p>Add the line</p> <pre><code>-L$(BOOST_ROOT)/lib\n</code></pre> <p>to the makefile, the relevant section should look like this</p> <pre><code>LIBRARY_PATH = -Llib \\\n               -L/opt/cactus/lib \\\n               -L$(CACTUS_ROOT)/lib \\\n               -L$(CACTUS_ROOT)/uhal/uhal/lib \\\n               -L$(CACTUS_ROOT)/uhal/grammars/lib \\\n               -L$(CACTUS_ROOT)/uhal/log/lib \\\n               -L$(CACTUS_ROOT)/extern/pugixml/RPMBUILD/SOURCES/lib \\\n               -L$(CACTUS_ROOT)/extern/boost/RPMBUILD/SOURCES/lib \\\n               -L$(BOOST_ROOT)/lib\n</code></pre> <p>3 Make <code>programFirmware</code> executable</p> <pre><code>make\ncd bin\n</code></pre> <p>verify <code>programFirmware</code> has been made.</p> <p>4 Program the WFD5 See</p> <pre><code>./programFirmware \n</code></pre> <p>for usage. For example:</p> <pre><code>./programFirmware 1 1 /path/to/wfdConfig/releases/wfd_master_0x030101.mcs /path/to/wfdConfig/releases/wfd_channel_0x030101.mcs /path/to/wfdConfig/releases/wfd_channel_async_0x030101.mcs /path/to/wfdConfig/releases/wfd_channel_cbuf_0x030101.mcs\n</code></pre> <p>where you replace <code>/path/to</code> with the appropriate paths. This will apply firmware version 3.1.1 to the WFD5 in crate 1 slot 1. Supposedly you can use this command to program multiple WFD5s at once, though I've never tried.</p>"},{"location":"hardware_overview/#fc7-flexible-controller","title":"FC7 (Flexible Controller)","text":""},{"location":"hardware_overview/#overview_6","title":"Overview","text":"<p>For our use case, the FC7 can be viewed as a hub that sends out Timing, Trigger, and Control (TTC) Signals to the AMC13s. It is a much more general tool developed by CERN, you can read more about it at a surface level in this presentation. Additionally, there are some detailed schematics.</p> <p>The FC7 has two slots for FMC modules. Usually, the top slot is for an SFP interface. The bottom slot is for the FMC that handles trigger and clock input.</p>"},{"location":"hardware_overview/#fmcs","title":"FMCs","text":""},{"location":"hardware_overview/#sfp-interface","title":"SFP Interface","text":"<p>The SFP interface is more or less \"plug and play\". You should familiarize yourself with the FC7 labeling. This needs to be placed in the top slot. Also this slot this is in needs to be specified in the ODB.</p>"},{"location":"hardware_overview/#trigger-and-clock-input-interface","title":"Trigger and Clock Input Interface","text":"<p>The trigger and clock input interface uses a digital I/O board. The FC7 firmware is configured to use channels 4-7 for input, and 0-3 for output; on the board there are microswitches you must toggle on the digital I/O board. For incoming signals that will expect 50 Ohm termination, you should apply a jumper shown in page 4 of the digital I/O board quick reference.</p> <p>In some setups, there is also a 2nd mezzanine card that then mounts on that FMC card to route the I/O through coax ribbon cables. This connects to the bank board.</p>"},{"location":"hardware_overview/#wired-connections_2","title":"Wired Connections","text":""},{"location":"hardware_overview/#optical-link-to-amc13","title":"Optical Link to AMC13","text":"<p>The FC7 sends trigger information to the AMC13s over an optical cable. This allows one FC7 to send triggers to up to 8 crates. Fill in the FC7 SFP ports with Finisar (or similar) SFP transceiver(s), one for each AMC13. Connect it to the appropriate SFP port in the AMC13.</p> <p>See the labeled DAQ Picture trigger out FC7.</p>"},{"location":"hardware_overview/#samtech-ribbon-cable-to-bank-board","title":"Samtech Ribbon cable to Bank Board","text":"<p>A ribbon cable is used to carry TTC signals from the FC7 to a signal bank board. The ribbon cable used is a Samtec HHSC-108-40.00-SU-SU (the 40.00 specifies the length, which need not be 40 cm). This cable runs between the trigger and clock input interface FMC and the bank board; this diagram bank board may be helpful.</p> <p>See the labeled DAQ Picture FC7 trigger in.</p>"},{"location":"hardware_overview/#configuration_5","title":"Configuration","text":"<p>First you should configure the MCH if you haven't already.</p> <p>For most of the configuration below to work, you must have cactus installed and linked with python. There are FC7 python configuration scripts located on the PIONEER github. Some of these scripts are written in python 2, it's easiest to manually update the syntax to be compatible with python 3. After setting up your github account, You can clone the repository with:</p> <pre><code>git clone git@github.com:PIONEER-Experiment/unifiedCCC.git\n</code></pre> <p>Below are a few examples of using the configuration scripts.</p>"},{"location":"hardware_overview/#reading-ip-address_1","title":"Reading IP Address","text":"<pre><code>cd unifiedCCC/software\npython read_addresses.py\n</code></pre> <p>This will print usage help.</p>"},{"location":"hardware_overview/#changing-ip-address_1","title":"Changing IP Address","text":"<pre><code>cd unifiedCCC/software\npython store_ip.py\n</code></pre> <p>This will print usage help.</p> <p>You should set the IP to be in the format <code>192.168.[crate number].[slot number]</code> for the DAQ to work properly.</p> <p>You may need to power cycle (pull the black handle out and push it back in) after this, I don't remember. </p> <p>Then verify you can ping the address</p> <pre><code>ping 192.168.[crate].[slot]\n</code></pre>"},{"location":"hardware_overview/#reading-status_1","title":"Reading Status","text":"<pre><code>cd unifiedCCC/software\npython read_status.py [crate] [slot] [options]\n</code></pre> <p>Note: You should use the <code>expert</code> option for this, otherwise </p>"},{"location":"hardware_overview/#updating-firmware_1","title":"Updating Firmware","text":"<p>You need to set the IP before doing this.</p> <p>It will be easier if you install the DAQ software before doing this. In particular, you want the environment variable <code>BOOST_ROOT</code> declared in your shell session. Additionally, you'll want the address table located in the g-2 modified DAQ repository.</p> <p>You may be able to simply make the FC7 firmware updating tool with</p> <pre><code>cd unifiedCCC/software/flash\nmake\n</code></pre> <p>If so, skip to step 4 below.</p> <p>1 Setup environment (if not already)</p> <pre><code>cd /path/to/gm2daq-modified/environment_setup/\nsource ./setup_environment.sh\ncd /path/to/unifiedCCC/software/flash\n</code></pre> <p>where you replace <code>/path/to</code> with the appropriate paths.</p> <pre><code>export LD_LIBRARY_PATH=$(pwd)/lib:$LD_LIBRARY_PATH\nexport CPLUS_INCLUDE_PATH=\"$BOOST_ROOT/include:$CPLUS_INCLUDE_PATH\"\n</code></pre> <p>2 Edit makefile</p> <p>Using your favorite text editor, open the makefile</p> <pre><code>vi Makefile\n</code></pre> <p>Add the line</p> <pre><code>-L$(BOOST_ROOT)/lib\n</code></pre> <p>to the makefile, the relevant section should look like this</p> <pre><code>LIBRARY_PATH = -Llib \\\n               -L/opt/cactus/lib \\\n               -L$(CACTUS_ROOT)/lib \\\n               -L$(CACTUS_ROOT)/uhal/uhal/lib \\\n               -L$(CACTUS_ROOT)/uhal/grammars/lib \\\n               -L$(CACTUS_ROOT)/uhal/log/lib \\\n               -L$(CACTUS_ROOT)/extern/pugixml/RPMBUILD/SOURCES/lib \\\n               -L$(CACTUS_ROOT)/extern/boost/RPMBUILD/SOURCES/lib \\\n               -L$(BOOST_ROOT)/lib\n</code></pre> <p>3 Make <code>programFC7</code> executable</p> <pre><code>make\ncd bin\n</code></pre> <p>verify <code>programFC7</code> has been made.</p> <p>4 Program the FC7 See</p> <pre><code>./programFC7\n</code></pre> <p>for usage. For example:</p> <pre><code>./programFC7 1 11 /path/to/unifiedCCC/releases/fc7_unified_0x080107.mcs /path/to/gm2daq-modified/address_tables/FC7_CCC.xml\n</code></pre> <p>where you replace <code>/path/to</code> with the appropriate paths. This will apply firmware version 8.1.7 to the FC7 in crate 1 slot 11.</p>"},{"location":"hardware_overview/#amc13-advanced-mezzanine-card","title":"AMC13 (Advanced Mezzanine Card)","text":""},{"location":"hardware_overview/#overview_7","title":"Overview","text":"<p>The AMC13 is an AMC developed by Boston University for g-2 as well as experiments at CERN. For our use case, it gathers data from digitizers whenever it recieves a trigger. It then packages them and sends them to the frontend hosting computer over 10GbE. There is some general information on Boston Unviversity's TWiki page. Some of the python scripts below are written in python 2, it's easiest to manually update the syntax to be compatible with python 3.</p>"},{"location":"hardware_overview/#wired-connections_3","title":"Wired Connections","text":""},{"location":"hardware_overview/#optical-link-to-fc7","title":"Optical Link to FC7","text":"<p>The FC7 sends trigger information to the AMC13s over an optical cable. Put a Finisar (or similar) SFP transceiver in the bottom SFP port in the AMC13. Connect it to the appropriate SFP port in the FC7.</p> <p>See the labeled DAQ Picture Trigger in AMC13.</p>"},{"location":"hardware_overview/#10gbe-link-to-daq-computer","title":"10GbE Link to DAQ computer","text":"<p>The AMC13 sends data to DAQ computer over an optical cable. Put an Avago (or similar) SFP transceiver in the top SFP+ port in the AMC13. Connect it to the 10GbE NIC in the DAQ computer.</p> <p>See the labeled DAQ Picture 10GbE out.</p>"},{"location":"hardware_overview/#configuration_6","title":"Configuration","text":"<p>First you should configure the MCH and configure the 10GbE NIC if you haven't already.</p> <p>The AMC13 is largely configured with AMC13Tool2.exe.The tools to configure the AMC13 are located in the g-2 modified DAQ repository, so you'll want to install the DAQ software before doing this. For some AMC13s, you need to set the IP addresses and reconfigure using AMC13Tool2.exe every time the module is power cycled.</p>"},{"location":"hardware_overview/#reading-ip-address_2","title":"Reading IP Address","text":"<p>In your favorite text editor, edit <code>systemVars.py</code></p> <pre><code>cd $GM2DAQ_DIR/amc13/amc13_v1_2_18/dev_tools/amc13Config\nvi systemVars.py\n</code></pre> <p>Ensure <code>DEFAULT_HOST_IP</code> corresponds to the MCH IP for this AMC13's crate. Additionally, ensure the <code>NETWORK_BASE</code> is correct. This example file is provided:</p> <pre><code>#File to specify what the default varaibles addresses are used in your system\n\n#Default IP address for commercial MCH module\n# our NAT MCH address\n#DEFAULT_HOST_IP=\"192.168.1.41\"\n# our Vadatech MCH address\nDEFAULT_HOST_IP=\"192.168.2.15\"\n\n#Default AMC13 slot number\nDEFAULT_AMC13_SLOT=13\n\n#Location of 'config_tools'. This should never need to be changed\nDEFAULT_CONFIG_DIR=\"./config_tools\"\n\n#Network base for your uTCA crate's AMC modules\n#NETWORK_BASE=\"192.168.1\"\nNETWORK_BASE=\"192.168.2\"\n</code></pre> <p>Then you can run</p> <pre><code>python readIPs.py\n</code></pre>"},{"location":"hardware_overview/#changing-ip-address_2","title":"Changing IP Address","text":"<p>In your favorite text editor, edit <code>systemVars.py</code></p> <pre><code>cd $GM2DAQ_DIR/amc13/amc13_v1_2_18/dev_tools/amc13Config\nvi systemVars.py\n</code></pre> <p>Ensure <code>DEFAULT_HOST_IP</code> corresponds to the MCH IP for this AMC13's crate. Additionally, ensure the <code>NETWORK_BASE</code> is correct. This example file is provided:</p> <pre><code>#File to specify what the default varaibles addresses are used in your system\n\n#Default IP address for commercial MCH module\n# our NAT MCH address\n#DEFAULT_HOST_IP=\"192.168.1.41\"\n# our Vadatech MCH address\nDEFAULT_HOST_IP=\"192.168.2.15\"\n\n#Default AMC13 slot number\nDEFAULT_AMC13_SLOT=13\n\n#Location of 'config_tools'. This should never need to be changed\nDEFAULT_CONFIG_DIR=\"./config_tools\"\n\n#Network base for your uTCA crate's AMC modules\n#NETWORK_BASE=\"192.168.1\"\nNETWORK_BASE=\"192.168.2\"\n</code></pre> <p>Then you can run</p> <pre><code>python applyConfig.py -i 192.168.[crate].13\n</code></pre> <p>This will set the T1 (virtex FPGA) IP to <code>192.168.[crate].13</code> and the T2 (spartan FPGA) IP to <code>192.168.[crate].14</code>.</p> <p>Then verify you can ping the addresses</p> <pre><code>ping 192.168.[crate].13\nping 192.168.[crate].14\n</code></pre>"},{"location":"hardware_overview/#building-amc13tool2exe","title":"Building AMC13Tool2.exe","text":"<p>You need to set the IP before doing this.</p> <p>1 Set up environment</p> <p>You may need to find where you python includes are</p> <pre><code>python-config --includes\n</code></pre> <p>make note of the directory (without the <code>-I</code>). And add it to your C++ include path, for example:</p> <pre><code>export CPLUS_INCLUDE_PATH=$CPLUS_INCLUDE_PATH:/opt/rh/rh-python36/root/usr/include/python3.6m\n</code></pre> <p>Then add library paths</p> <pre><code>export LD_LIBRARY_PATH=$GM2DAQ_DIR/amc13/amc13_v1_2_18/amc13/lib/:$LD_LIBRARY_PATH\nexport LD_LIBRARY_PATH=$GM2DAQ_DIR/amc13/amc13_v1_2_18/tools/lib:$LD_LIBRARY_PATH\n</code></pre> <p>2 Make AMC13 Library</p> <pre><code>cd $GM2DAQ_DIR/amc13/amc13_v1_2_18/amc13\nmake\n</code></pre> <p>Note: The <code>make</code> command may complain about the version being invalid. As long as <code>$GM2DAQ_DIR/amc13/amc13_v1_2_18/amc13/libcactus_amc13_amc13.so</code> gets generated this won't matter.</p> <p>3 Make AMC13Tool2.exe</p> <pre><code>cd $GM2DAQ_DIR/amc13/amc13_v1_2_18/tools\nmake\n</code></pre> <p>Note: I had trouble building AMC13Tool2.exe at first. I had to make some edits to the C++ code to get it to compile; those edits should be included in the multi-crate (or newer) branch of the DAQ repository.</p> <p>4 Run AMC13Tool2.exe</p> <p>Try running AMC13Tool2.exe</p> <pre><code>bin/AMC13Tool2.exe -c 192.168.[crate #].13 -p $GM2DAQ_DIR/address_tables/\n</code></pre> <p>Enter <code>h</code> for available commands.</p>"},{"location":"hardware_overview/#configuring-the-amc13-with-amc13tool2exe","title":"Configuring the AMC13 with AMC13Tool2.exe","text":"<p>AMC13Tool2.exe has a command guide provided by Boston Unversity. For our case we just want to run the following:</p> <p>1 Run AMC13Tool2.exe</p> <pre><code>cd $GM2DAQ_DIR/amc13/amc13_v1_2_18/tools\nbin/AMC13Tool2.exe -c 192.168.[crate #].13 -p $GM2DAQ_DIR/address_tables/\n</code></pre> <p>2 Initialize AMC13 for data taking</p> <pre><code>en 1-12\n</code></pre> <p>3 Enable SFPs</p> <pre><code>daq 1\n</code></pre> <p>4 Change IP of 10GbE Port First read the value and make note:</p> <pre><code>rv 0x1c1c \n</code></pre> <p>Then write the value to an IP on your 10GbE port network, for example:</p> <pre><code>wv 0x1c1c 0xc0a83301\n</code></pre> <p>where the hex converts to IP as such:</p> <pre><code>c0 = 192\na8 = 168\n33 = 51\n01 = 1\n</code></pre> <p>So This sets the IP to 192.168.51.1. You want to set this value in the ODB to correspond to this IP.</p> <p>5 Issue DAQ reset</p> <pre><code>rd\n</code></pre> <p>6 Quit AMC13Tool2</p> <pre><code>q\n</code></pre> <p>7 Verify you can ping the 10GbE link For example:</p> <pre><code>ping 192.168.51.1\n</code></pre> <p>Note: Sometimes this doesn't work for me. You can also try running the commands inside the AMC13Tool2.exe CLI this order instead:</p> <pre><code>en 1-12\ndaq 1\nrd\nwv 0x1c1c 0xc0a83301\n</code></pre>"},{"location":"hardware_overview/#updating-firmware_2","title":"Updating Firmware","text":"<p>See Boston University's firmware guide for more details.+</p> <p>1 Download Firmware See the download page for various firmware versions. We want T1 (virtex) version 33087 (0x813f) and T2 (spartan) version 46 (0x2e). You can download them using wget:</p> <pre><code>cd $GM2DAQ_DIR/amc13/amc13_v1_2_18/tools\nwget http://ohm.bu.edu/~amc13/CMS/AMC13-Firmware/AMC13T2v0x002e_6slx45t.mcs\nwget http://ohm.bu.edu/~amc13/CMS/AMC13-Firmware/AMC13T1v0x813f_7k325t.mcs\n</code></pre> <p>2 Update Firmware</p> <pre><code>bin/AMC13Tool2.exe -c 192.168.[crate #].13 -p $GM2DAQ_DIR/address_tables/\n</code></pre> <p>In the CLI:</p> <pre><code>pv \n</code></pre> <p>Select the correct firmware from the options listed. Then repeat for the spartan</p> <pre><code>ps\n</code></pre> <p>3 Verify Firmware Version is Correct</p> <p>You can verify the firmware updated correctly with</p> <pre><code>list\n</code></pre> <p>example output:</p> <pre><code>Connected AMC13s\n*0: SN: 268 T1v: 813f T2v: 002e cf: 192.168.1.13\n</code></pre>"},{"location":"hardware_overview/#meinberg-card-tcr180pex-or-similar","title":"Meinberg Card (TCR180PEX or similar)","text":""},{"location":"hardware_overview/#overview_8","title":"Overview","text":"<p>The Meinberg card provides GPS timestamps for data triggers. It is an artifact from g-2 that doesn't serve much purpose for the g-2 modified DAQ. However, it is still a supported trigger system for the Master Frontend.</p>"},{"location":"hardware_overview/#wired-connections_4","title":"Wired Connections","text":""},{"location":"hardware_overview/#sma-to-d9-connector","title":"SMA to D9 Connector","text":"<p>A custom cable must be created to connect the meinberg to the signal bank. One end needs to end up as SMA (for the bank) while the other needs to be a 9pin D-SUB connector (for the meinberg). There is pinout in section 10 (page 27) of the meinberg manual.</p>"},{"location":"hardware_overview/#configuration_7","title":"Configuration","text":"<p>See the Meinberg manual for detailed configuration. Furthermore, there are meinberg command line tools detailed on their website. After the meinberg drivers are installed and loaded, there should be no additional configuration to be done.</p>"},{"location":"installing_and_building/","title":"Installing and Running g-2 modified DAQ","text":""},{"location":"installing_and_building/#overview","title":"Overview","text":"<p>The g-2 modified DAQ software repurposes the DAQ software used for g-2 to be slightly more flexible. It allows for readout and communication with hardware described in the Hardware Overview page.</p>"},{"location":"installing_and_building/#software-diagram","title":"Software Diagram","text":"<p> Note: Not pictured are the hardware links, see Hardware Diagram</p>"},{"location":"installing_and_building/#mastergm2","title":"MasterGM2","text":"<p>This is a C++ executable midas frontend whose job is to count triggers to check that crate hardware and CaloReadoutAMC13 frontends are not missing triggers.</p> <ul> <li>Trigger Thread: Recieves processed triggers from a source (ex. Meinberg PCIe Card) and reports them to the Midas thread.</li> <li>Midas Thread: Puts data recieved from trigger thread into a midas bank for each event</li> </ul>"},{"location":"installing_and_building/#caloreadoutamc13","title":"CaloReadoutAMC13","text":"<p>This is a C++ executable midas frontend whose job is to recieve digitized data from the AMC13 and process it before being placed in midas data banks.</p> <ul> <li>TCP Thread: Recieves TCP packets over 10GbE from an AMC13. Unpacks the data into header, trailer, and payload information.</li> <li>\"GPU\" Thread: Recieves processed data from TCP thread. In g-2, GPUs were used for additional data processing. They have been turned off and the \"GPU\" thread is a legacy buffer for the data to go through. No processing is done on the data here.</li> <li>Midas Thread: Puts data recieved from gpu thread into midas banks for each event</li> </ul>"},{"location":"installing_and_building/#event-builder","title":"Event Builder","text":"<p>This is a C++ executable midas frontend whose job is to collect data sitting in the midas buffers of all the frontends (MasterGM2, CaloReadoutAMC13 #1, CaloReadoutAMC13 #2, ...) and combine them into one midas event before being logged to a data file.</p>"},{"location":"installing_and_building/#installer","title":"Installer","text":"<p>There is an installer for the g-2 modified DAQ. Though, it is currently out of date and I would not recommend using it.</p>"},{"location":"installing_and_building/#manual-installation-guide","title":"Manual Installation Guide","text":"<p>1 Install Software Dependencies</p> <p>ROOT, Midas, Boost, ipmitool, and Cactus, and the System Monitor are all required to build and run the DAQ frontends. Meinberg is needed if using GPS mode for the master triggers. Install them following the instructions on the Software Dependencies Page.</p> <p>2 Clone the Appropriate Branch</p> <p>Make sure you have access to the PIONEER Experiment GitHub. See these contacts for gaining access. Additionally, make sure your github account is linked to your system via SSH token; you can do this by following these instructions. After installing the software dependencies, you should have a <code>packages</code> directory, where it's best to put the software. To clone, follow the commands below:</p> <pre><code>cd /path/to/packages\nmkdir experiment\ncd experiment\ngit clone --branch alma9 git@github.com:PIONEER-Experiment/gm2daq-modified.git\ncd gm2daq-modified\ngit checkout alma9\n</code></pre> <p>Note: To clone a different branch, simply change the <code>--branch</code> parameter from <code>multi-crate</code> to the appropriate branch. You can also checkout a different branch after this is done.</p> <p>3 Setup Environment</p> <pre><code>cd environment_setup\n./detect_environment.sh\n</code></pre> <p>Note: The environment detection does not work well for packages installed with <code>yum</code> or other package managers. The correct directory for these packges is usually <code>/usr</code>, (though cactus installs into <code>/opt</code>).</p> <p>This will populate a local file <code>environment_variables.txt</code>, check it with:</p> <pre><code>cat environment_variables.txt\n</code></pre> <p>Here's an example of what <code>environment_variables.txt</code> will look like</p> <pre><code>GM2DAQ_DIR=/home/pioneer/packages/experiments/gm2daq-modified\nCACTUS_ROOT=/opt/cactus\nBOOST_ROOT=/usr\nPUGIXML_ROOT=/usr\nROOT_ROOT=/usr\nMIDASSYS=/home/pioneer/packages/midas\nMIDAS_EXPTAB=/home/pioneer/online/exptab\nMIDAS_EXPT_NAME=DAQ\n</code></pre> <p>Verify that each environment variable above points to the correct path for each piece of software. If not, manually change it with your favorite text editor. Then, run</p> <pre><code>source ./setup_environment.sh\n</code></pre> <p>Note: To set up the environment every time you log in automatically, source this script in your <code>.bashrc</code> file. Modify the path in the following command to add <code>setup_environment.sh</code> with the <code>--silent</code> flagto the .bashrc file</p> <pre><code>echo \"source /path/to/gm2daq-modified/environment_setup/setup_environment.sh --silent\" &gt;&gt; ~/.bashrc\n</code></pre> <p>4 Make Frontends</p> <p>Make the master frontend:</p> <pre><code>cd $GM2DAQ_DIR/frontends/MasterGM2\nmake clean\nmake -j$(nproc)\n</code></pre> <p>Make the AMC13 readout frontend:</p> <pre><code>cd $GM2DAQ_DIR/frontends/CaloReadoutAMC13\nmake clean\nmake -j$(nproc)\n</code></pre> <p>Make the event builder frontend:</p> <pre><code>cd $GM2DAQ_DIR/eventbuilder\nmake clean\nmake\n</code></pre> <p>5 Configure Crate Contents File</p> <p>Edit <code>AMC13xx_config.xml</code> file in your favorite text edit, for instance:</p> <pre><code>vi $GM2DAQ_DIR/frontends/AMC13xx_config.xml\n</code></pre> <p>An example file for a one crate system looks like this:</p> <pre><code>&lt;!-- The purpose of this file is to specify what devices are in each frontend crate --&gt;\n&lt;!-- To declare frontend AMC13xx create root node &lt;frontend id=\"xx\"&gt;  --&gt;\n&lt;!-- (xx = \"0\" will automatically be written as \"00\" in ODB settings, i.e. single digits are okay) --&gt;\n&lt;!-- To declare device in slot 'y' of create, create node &lt;slot id=\"y\" type=\"device_type\" --&gt;\n&lt;!-- Select \"device_type\" from FC7, WFD, or Rider (WFD and Rider are the same device) --&gt;\n&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;frontend id=\"1\"&gt;\n    &lt;slot id=\"1\"  type=\"WFD\" /&gt;\n    &lt;slot id=\"2\"  type=\"WFD\" /&gt;\n    &lt;slot id=\"3\"  type=\"WFD\" /&gt;\n    &lt;slot id=\"4\"  type=\"WFD\" /&gt;\n    &lt;slot id=\"5\"  type=\"WFD\" /&gt;\n    &lt;slot id=\"6\"  type=\"WFD\" /&gt;\n    &lt;slot id=\"7\"  type=\"WFD\" /&gt;\n    &lt;slot id=\"10\" type=\"FC7\" /&gt;\n    &lt;slot id=\"11\"  type=\"WFD\" /&gt;\n&lt;/frontend&gt;\n</code></pre> <p>An example file for a two crate system looks this like:</p> <pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;frontend id=\"1\"&gt;\n    &lt;slot id=\"1\"  type=\"WFD\" /&gt;\n    &lt;slot id=\"2\"  type=\"WFD\" /&gt;\n    &lt;slot id=\"3\"  type=\"WFD\" /&gt;\n    &lt;slot id=\"4\"  type=\"WFD\" /&gt;\n    &lt;slot id=\"5\"  type=\"WFD\" /&gt;\n    &lt;slot id=\"6\"  type=\"WFD\" /&gt;\n    &lt;slot id=\"7\"  type=\"WFD\" /&gt;\n    &lt;slot id=\"10\" type=\"FC7\" /&gt;\n    &lt;slot id=\"11\"  type=\"WFD\" /&gt;\n&lt;/frontend&gt;\n&lt;frontend id=\"2\"&gt;\n    &lt;slot id=\"3\" type=\"WFD\" /&gt;\n    &lt;slot id=\"5\" type=\"WFD\" /&gt;\n&lt;/frontend&gt;\n</code></pre> <p>Note: The frontend id should correspond to the subnet you placed (or will place) the crate components on when configuring the hardware.</p> <p>This file is used to build the ODB. Any hardware not specified in this file will be ignored. You can still disable any hardware listed in this file in the ODB after it has been generated. However if you want to move the FC7 to a different slot, this file and the ODB need to be editted accordingly.</p> <p>You then need to copy this file to your experiment directory. You can find that directory with</p> <pre><code>cat $MIDAS_EXPTAB\n</code></pre> <p>navigate to the appropriate directory then run the command</p> <pre><code>cp $GM2DAQ_DIR/frontends/AMC13xx_config.xml .\n</code></pre> <p>6 Start Midas Webpage</p> <pre><code>cd $GM2DAQ_DIR/webpage_scripts\n./start_midas_webpage.sh\n</code></pre> <p>Then open <code>localhost:8080</code> in your favorite web browser.</p> <p>Note: If this doesn't work, verify that <code>mlogger</code>, <code>mhttpd</code> (or <code>mhttpd6</code>), and <code>mserver</code> and all running as screens, i.e. check:</p> <pre><code>screen -ls\n</code></pre> <p>You can also run <code>mhttpd</code> manually to look for error messages for debugging:</p> <pre><code>$MIDASSYS/bin/mhttpd\n</code></pre> <p>7 Generate the ODB</p> <p>The first time the frontends are run, they will automatically populate the ODB with the default settings. Run the frontends for the first time (they will error out):</p> <pre><code>cd $GM2DAQ_DIR/frontends/MasterGM2\n./frontend -e DAQ\n</code></pre> <pre><code>cd $GM2DAQ_DIR/frontends/CaloReadoutAMC13\n./frontend -e DAQ -i {frontend id}\n</code></pre> <p>where <code>{frontend id}</code> is replaced with the frontend ids specified in the crate configuration file above. This command needs to be run once for each frontend (each crate) to properly generate the ODB.</p> <p>On the midas webpage view the ODB. Verify that <code>/Equipment/MasterGM2</code> and each <code>/Equipment/AMC13xxx</code> now exist.</p> <p>8 Configure the ODB</p> <p>Before the DAQ can run, the ODB needs to be properly configured. First, make sure the Logger writes data and makes ODB backup files for each run. Then following the instructions on the ODB configuration page, read through each setting and ensure they are correct for your setup.</p>"},{"location":"installing_and_building/#running-the-frontends","title":"Running the Frontends","text":""},{"location":"installing_and_building/#starting-frontends-by-hand","title":"Starting Frontends \"by Hand\"","text":"<p>The first time you run the frontends, I suggest dedicating one terminal window to each so you can inspect for errors. Each frontend will occupy a terminal window.</p>"},{"location":"installing_and_building/#master-frontend","title":"Master Frontend","text":"<p>The Master frontend must be started first because it does some general AMC13 and FC7 initilization. Run</p> <pre><code>cd $GM2DAQ_DIR/frontends/MasterGM2\n./frontend -e DAQ\n</code></pre> <p>The <code>-e</code> flag specifies the experiment name. This is found in the file located at <code>$MIDAS_EXPTAB</code>.</p> <p>Wait until this frontend prints <code>OK</code> (or until it turns and stays green on the midas status webpage).</p>"},{"location":"installing_and_building/#amc13-readout-frontends","title":"AMC13 Readout Frontends","text":"<p>This frontend(s) must be started after the Master frontend has initialized. You can start multiple instances at the same time, but in my experience this causes midas to complain about ODB space (you may be able to get around this by increasing the ODB size, I've never tried).</p> <pre><code>cd $GM2DAQ_DIR/frontends/CaloReadoutAMC13\n./frontend -e DAQ -i {frontend id}\n</code></pre> <p>The <code>-e</code> flag specifies the experiment name. This is found in the file located at <code>$MIDAS_EXPTAB</code>.  The <code>-i</code> flag specifies frontend index. <code>{frontend id}</code> is replaced with the frontend ids specified in the crate configuration file above.  This command needs to be run once for each AMC13 frontend (each crate). </p> <p>Wait until this frontend prints <code>OK</code> (or until it turns and stays green on the midas status webpage).</p>"},{"location":"installing_and_building/#event-builder-frontend","title":"Event Builder Frontend","text":"<p>Once all of the other frontends have finished initializing, you can start the event builder.</p> <pre><code>./mevb -e DAQ -b BUF\n</code></pre> <p>The <code>-e</code> flag specifies the experiment name. This is found in the file located at <code>$MIDAS_EXPTAB</code>.  The <code>-b</code> flag specifies the buffer it will look for to create events. Any frontend writing to a buffer starting with <code>BUF</code> will added to an event by the event builder. You can check each frontend's buffer in it's <code>Common</code> page in the ODB, see changing buffer for a frontend.</p> <p>Wait until this frontend turns green on the status page.</p>"},{"location":"installing_and_building/#screening-the-frontends","title":"Screening the Frontends","text":"<p>Screening the frontends is slightly convoluted because you have to stuff all the appropriate environment variables into the screen session. If you are unfamiliar with screens, you may want view some learning material for using screens. You made need to make an edit to your .screenrc for this to work properly. Other than this, there are scripts provided to launch the frontends in a screen.</p>"},{"location":"installing_and_building/#master-frontend_1","title":"Master Frontend","text":"<p>The Master frontend must be started first because it does some general AMC13 and FC7 initilization. Run</p> <pre><code>$GM2DAQ_DIR/frontends/MasterGM2/start-fe-uky.sh DAQ master\n</code></pre> <p>The first argument is the experiment name which should be the value of <code>$MIDAS_EXPT_NAME</code>.  The second argument is the name for the screen session.</p> <p>Wait until this frontend prints <code>OK</code> (or until it turns and stays green on the midas status webpage).</p>"},{"location":"installing_and_building/#amc13-readout-frontends_1","title":"AMC13 Readout Frontends","text":"<p>This frontend(s) must be started after the Master frontend has initialized. You can start multiple instances at the same time, but in my experience this causes midas to complain about ODB space (you may be able to get around this by increasing the ODB size, I've never tried).</p> <pre><code>$GM2DAQ_DIR/frontends/CaloReadoutAMC13/start-fe-uw.sh 1 DAQ amc13001\n</code></pre> <p>The 1st argument is the frontend index, it should match the <code>-i</code> argument when starting this frontend by hand.  The 2nd argument is the experiment name. This is found in the file located at <code>$MIDAS_EXPTAB</code>.  The 3rd is the name for the screen session.</p> <p>This command needs to be run once for each AMC13 frontend (each crate). </p> <p>Wait until this frontend prints <code>OK</code> (or until it turns and stays green on the midas status webpage).</p>"},{"location":"installing_and_building/#event-builder-frontend_1","title":"Event Builder Frontend","text":"<p>Once all of the other frontends have finished initializing, you can start the event builder. There is no script for this screen, just a simple screen command. The flags are the same as when starting this frontend by hand.</p> <pre><code>screen -dmS event_builder $GM2DAQ_DIR/eventbuilder/mevb -e DAQ -b BUF\n</code></pre>"},{"location":"installing_and_building/#startup-scripts-on-midas-programs-page","title":"Startup Scripts on Midas Programs Page","text":"<p>See the adding program startup scripts page to see how to add startup programs. Make <code>Programs/{Frontend Name}/Required</code> is set to <code>yes</code>. Then copy the screen command for each respective frontend into <code>Programs/{Frontend Name}/Start Command</code>.</p>"},{"location":"midas/","title":"Some Midas Information and Tips","text":"<p>TRIUMF has a great Midas Wiki page. For general midas information, this is a good place to start. Below, there are some specific tips about midas that are helpful when using the g-2 modified DAQ.</p>"},{"location":"midas/#data-storage-location","title":"Data Storage location","text":"<p>By default midas files (.mid) and compressed midas files (.mid.lz4) will be stored in the same directory that the file <code>$MIDAS_EXPTAB</code> points to for the experiment (usually the \"online\" directory). This can be can be changed to a different directory in the Logger's ODB settings.</p>"},{"location":"midas/#multiple-experiments-on-one-midas-installation","title":"Multiple Experiments on One Midas Installation","text":"<p>To run multiple experiments (with different ODBs), one needs to modify the <code>$MIDAS_EXPTAB</code> file. See the Exptab wiki page. Edit <code>$MIDAS_EXPTAB</code> in your favorite text editor, for example:</p> <pre><code>vi $MIDAS_EXPTAB`\n</code></pre> <p>Then add a new line for another experiment, the experiment directory must be different:</p> <pre><code>DAQ  /experiment_one/home/online system\ntest /experiment_two/home/online system\n</code></pre> <p>replace the paths above to correspond to a path on your system. These are the directories the ODB information is stored.</p> <p>Make sure all desired midas applications use the correct experiment name. For example, to start a midas webpage for experiment <code>test</code>, run</p> <pre><code>$MIDASSYS/bin/mhttpd -e test\n</code></pre>"},{"location":"midas/#midas-files-to-root-files-unpacker","title":"Midas Files to ROOT Files (unpacker)","text":"<p>See the unpacker software page.</p> <p>Once that is installed, you can convert midas files to root files using the command:</p> <pre><code>./pioneer_unpacker MIDAS_FILE.mid.lz4 0 detector_mapping.json\n</code></pre>"},{"location":"midas/#recovering-from-a-corrupted-odb","title":"Recovering from a Corrupted ODB","text":"<p>There should be a folder in <code>$GM2DAQ_DIR/restore_corrupted_ODB</code> or <code>$GM2DAQ_DIR/scripts/restore_corrupted_ODB</code> (if not, you may need to look in the default branch). Navigate to this directory and run one of the following two scripts:</p> <p>Fun version:</p> <pre><code>./midas_restore.sh\n</code></pre> <p>Less fun version:</p> <pre><code>./delete_and_restore_odb.sh\n</code></pre> <p>Both scripts have the exact same functionality; they effectively stop all running screens (midas related or not), delete all ODB data, and load a backup file. However the first script has some fun surprises for the user's pleasure. If this script doesn't work, you can follow the steps in \"Fixing a persistently corrupted ODB by hand\".</p> <p>Note: </p>"},{"location":"midas/#fixing-a-corrupted-odb-by-hand","title":"Fixing a corrupted ODB by hand","text":"<p>These instructions are adapted from the midas wiki's page on recovering from a corrupted ODB. For most cases, you can just \"nuke\" the ODB and then load an ODB save file from a previous run. Make sure you have an ODB backup file to load (ex. run001234.json).</p> <p>1 Stop midas screens by hand</p> <pre><code>screen -ls\n</code></pre> <p>Note all midas screens running and close them, for instance:</p> <pre><code>screen -X -S mhttpd quit\nscreen -X -S mlogger quit\nscreen -X -S mserver quit\n</code></pre> <p>Verify they are all close with</p> <pre><code>screen -ls\n</code></pre> <p>once again.</p> <p>2 Reset the ODB to midas default</p> <pre><code>$MIDASSYS/bin/odbinit -s {ODB memory} --cleanup\n</code></pre> <p>Then follow the text prompts.</p> <p>For example:</p> <pre><code>$MIDASSYS/bin/odbinit -s 1024MB --cleanup\n</code></pre> <p>3 Load old ODB </p> <pre><code>$MIDASSYS/bin/odbedit -c \"load online/run001234.json\"'\n</code></pre> <p>Replace the path <code>online/run001234.json</code> with the location of an actual ODB backup that you know was working.</p>"},{"location":"midas/#fixing-a-persistently-corrupted-odb-by-hand","title":"Fixing a persistently corrupted ODB by hand","text":"<p>If nothing else works to fix a corrupted ODB, these steps act as a \"brute force\" reset. The steps below are actually the same steps done in the scripts mentioned in Recovering from a Corrupted ODB. Make sure you have an ODB backup file to load (ex. run001234.json).</p> <p>1 Forcefully close out of all screens on the machine</p> <pre><code>killall mserver mevb mlogger mhttpd mhttpd6 frontend mtransition &gt; /dev/null 2&gt;&amp;1\nkillall -9 mserver mevb mlogger mhttpd mhttpd6 frontend mtransition &gt; /dev/null 2&gt;&amp;1\n$MIDASSYS/progs/mcleanup &gt; /dev/null 2&gt;&amp;1\nscreen -wipe &gt; /dev/null 2&gt;&amp;1\nkillall screen &gt; /dev/null 2&gt;&amp;1\nscreen -wipe &gt; /dev/null 2&gt;&amp;1\n</code></pre> <p>2 Delete Shared Memory Files</p> <pre><code>export EXP=$MIDAS_EXPT_NAME\nexport EXP_PATH=$(dirname \"$MIDAS_EXPTAB\")\nrm -rf /dev/shm/*_${EXP}_ODB_* &gt; /dev/null 2&gt;&amp;1\nrm -rf $EXP_PATH/.*.SHM &gt; /dev/null 2&gt;&amp;1\nrm -rf $EXP_PATH/.*.TXT &gt; /dev/null 2&gt;&amp;1\n</code></pre> <p>Note: <code>EXP_PATH=$(dirname \"$MIDAS_EXPTAB\")</code> will be correct if you've followed this guide exclusively. However, in general the path you want is actually in the content of the <code>$MIDAS_EXPTAB</code> file. For example, the output of <code>cat $MIDAS_EXPTAB</code> could look like:</p> <pre><code>DAQ     /home/installation_testing/online system\nSIM_DAQ /home/installation_testing/online system\n</code></pre> <p>Really you want <code>export EXP_PATH=/home/installation_testing/online</code>, but in our setup we choose to put <code>$MIDAS_EXPTAB</code> in the \"online\" directory anyways, so this is the same as above. Just be mindful if your <code>$MIDAS_EXPTAB</code> file is located in a place other than your experiment ODB files.</p> <p>3 Create new ODB and load old ODB file</p> <pre><code>export JsonPath=online/run001234.json\nexport run_number=1000\n$MIDASSYS/bin/odbedit -e $EXP -s 40000000 -c \"ls\" &gt; /dev/null 2&gt;&amp;1\n$MIDASSYS/bin/odbedit -e $EXP -c \"load $JsonPath\" &gt; /dev/null 2&gt;&amp;1\n$MIDASSYS/bin/odbedit -e $EXP -c \"set \\\"/Runinfo/Run number\\\" $run_number\" &gt; /dev/null 2&gt;&amp;1\n</code></pre> <p>where <code>JsonPath</code> and <code>run_number</code> are replaced with the paths to an ODB backup and the desired starting run number respectively. You should set the run number to a value higher than your last run number as to not overwrite and data.</p> <p>4 Reload midas webpage</p> <pre><code>$MIDASSYS/bin/mhttpd\n</code></pre> <p>Verify everything looks as expected on the webpage. Then you can reload frontends and any other screens that were running beforehand.</p>"},{"location":"midas/#loading-an-odb-save","title":"Loading an ODB save","text":"<p>You can use the ODB to load an old ODB save file. </p> <pre><code>$MIDASSYS/bin/odbedit\n</code></pre> <p>Then in the command line interface:</p> <pre><code>load online/run001234.json\n</code></pre> <p>Alternatively, you can \"stuff\" commands into odbedit from command line:</p> <pre><code>$MIDASSYS/bin/odbedit -c \"load online/run001234.json\"'\n</code></pre> <p>where <code>online/run001234.json</code> should be replaced with a path to a valid ODB save file.</p>"},{"location":"midas/#changing-the-odb-size","title":"Changing the ODB size","text":"<p>See the midas wiki page for changing ODB size.</p> <p>1 Save Current ODB if needed</p> <pre><code>$MIDASSYS/bin/odbedit -c \"save current_odb.odb\"\n</code></pre> <p>2 Stop midas screens by hand</p> <pre><code>screen -ls\n</code></pre> <p>Note all midas screens running and close them, for instance:</p> <pre><code>screen -X -S mhttpd quit\nscreen -X -S mlogger quit\nscreen -X -S mserver quit\n</code></pre> <p>Verify they are all close with</p> <pre><code>screen -ls\n</code></pre> <p>once again.</p> <p>3 Delete Shared Memory Files</p> <pre><code>export EXP=$MIDAS_EXPT_NAME\nexport EXP_PATH=$(dirname \"$MIDAS_EXPTAB\")\nrm -rf /dev/shm/*_${EXP}_ODB_* &gt; /dev/null 2&gt;&amp;1\nrm -rf $EXP_PATH/.*.SHM &gt; /dev/null 2&gt;&amp;1\nrm -rf $EXP_PATH/.*.TXT &gt; /dev/null 2&gt;&amp;1\n</code></pre> <p>Note: <code>EXP_PATH=$(dirname \"$MIDAS_EXPTAB\")</code> will be correct if you've followed this guide exclusively. However, in general the path you want is actually in the content of the <code>$MIDAS_EXPTAB</code> file. For example, the output of <code>cat $MIDAS_EXPTAB</code> could look like:</p> <pre><code>DAQ     /home/installation_testing/online system\nSIM_DAQ /home/installation_testing/online system\n</code></pre> <p>Really you want <code>export EXP_PATH=/home/installation_testing/online</code>, but in our setup we choose to put <code>$MIDAS_EXPTAB</code> in the \"online\" directory anyways, so this is the same as above. Just be mindful if your <code>$MIDAS_EXPTAB</code> file is located in a place other than your experiment ODB files.</p> <p>4 Edit file $MIDASSYS/include/midas.h</p> <p>Find:</p> <pre><code>#define MAX_OPEN_RECORDS       256 \n</code></pre> <p>Change this to:</p> <pre><code>#define MAX_OPEN_RECORDS       65536\n</code></pre> <p>Note: This can be changed to a larger number (up to some limit I don't know)</p> <p>5 Edit file $MIDASSYS/src/odb.cxx</p> <p>Find:</p> <pre><code>assert(sizeof(DATABASE_CLIENT) == 2112);\nassert(sizeof(DATABASE_HEADER) == 135232);\n</code></pre> <p>Change to:</p> <pre><code>assert(sizeof(DATABASE_CLIENT) == 524352);\nassert(sizeof(DATABASE_HEADER) == 33558592);\n</code></pre> <p>Note: These numbers follow a formula on the wiki, they are related to the variable MAX_OPEN_RECORDS</p> <pre><code>DATABASE_CLIENT = 64 + 8*MAX_OPEN_RECORDS \nDATABASE_HEADER = 64 + 64*DATABASE_CLIENT\n</code></pre> <p>6 Remake MIDAS</p> <p>Follow the wiki's quickstart linux guide.</p> <pre><code>cd midas\nmkdir build\ncd build\ncmake ..\nmake install\n</code></pre> <p>7 Create new ODB</p> <pre><code>$MIDASSYS/bin/odbinit -s 1024MB --cleanup\n</code></pre> <p>Note: I had trouble unless the number specified by -s was the different than the previous ODB. From there it will prompt you to delete a file. I think this file contains information about the maximum number of hotlinks and must be deleted every time you want to increase the number of hotlinks</p> <p>8 Load old settings (if saved)</p> <pre><code>$MIDASSYS/bin/odbedit -c \"load current_odb.odb\"\n</code></pre> <p>9 Rebuild all programs with midas dependencies</p> <p>Because we rebuilt midas, this also means we have to rebuild the frontends. See the \"Make Frontends\" section of the frontend manual installation guide. Any other software you have built against this version of midas must also be rebuilt (that includes the publisher, for example).</p>"},{"location":"midas/#adding-program-startup-scripts","title":"Adding Program Startup Scripts","text":"<p>After any frontend is run, it will appear in the ODB under <code>/Programs/{Frontend Name}</code>. Here there are some settings for the program. The I use for starting frontends are</p> <p>Required:</p> <p>Set <code>/Programs/{Frontend Name}/Required</code> to <code>yes</code> to pin the program onto the <code>Programs</code> page accessible from the left sidebar. In other words, when the frontend is not running, it will not dissapear from the programs page.</p> <p>Start Command:</p> <p>Change <code>/Programs/{Frontend Name}/Start Command</code> to a command that you when to be run when hitting the <code>Start {Frontend Name}</code> button on the Programs page. This is allows the user to start a frontend in the background from the midas webpage; i.e. you can avoid starting frontends from command line.</p>"},{"location":"miscellaneous_info/","title":"Miscellaneous Information","text":""},{"location":"miscellaneous_info/#additional-notes","title":"Additional Notes","text":"<p>If you're feeling desperate (or perhaps lucky), you can sift through Jack Carlton's work notes. I warn you that these are not well organized and contain lots of information not about this DAQ. However, they do contain some documentation of my assembly and troubleshooting of this DAQ.</p>"},{"location":"miscellaneous_info/#what-is-was-g-2","title":"What is (was) g-2?","text":"<p>g-2 was an experiment to that examined the precession of muons that are subjected to a magnetic field to test the standard model's prediction of muon g factor. Because many of the g-2 collaborators now work on PIONEER, it is convienent to repurpose the data acquisition system used for g-2 for PIONEER test stands.</p>"},{"location":"miscellaneous_info/#initialism-cheatsheet","title":"Initialism Cheatsheet","text":"Initialism Meaning Example DAQ Data Acquisition ADC Analog-to-Digital Converter 10GbE 10 Gigabit Ethernet AFE Analog Front End FPGA Field Programmable Gate Array FMC FPGA Mezzanine Card FC7 SFP Interface CPU Central Processing Unit Intel Core i7-12700K GPU Graphics Processing Unit NVIDIA A5000 uTCA (\u00b5TCA) Micro Telecommunications Computing Architecture WFD Waveform Digitizer WFD5 FC Flexible Controller FC7 AMC Advanced Mezzanine Card AMC13 (also FC7 and WFD5) MCH MicroTCA Carrier Hub DDR Double Data Rate DDR3, DDR4 (RAM) PCIe Peripheral Component Interconnect Express PCIe2, PCIe3, ... SFP Small Form-factor Pluggable Finisar  SFP transceiver SFP+ Enhanced Small Form-factor Pluggable Avago SFP+ transceiver CLI Command Line Interface TTC Timing, Trigger, and Control MTU Maximum Transmission Unit IP Internet Protocol"},{"location":"miscellaneous_info/#differential-signals","title":"Differential Signals","text":"<p>Differential signals offer several advantages over single-ended signals:</p> <ul> <li>More resistant to noise: Differential signaling reduces susceptibility to noise interference, resulting in cleaner signal transmission.</li> <li>Lower supply voltages: Differential signaling allows for the use of lower supply voltages (like Low Voltage CMOS (LVCMOS) at 3.0\u20133.3V), which can lead to reduced power consumption.</li> <li>Higher operating frequencies: Due to better noise immunity and lower voltage swings, differential signals enable higher operating frequencies in electronic circuits.</li> </ul> <p>Read more about differential signaling on Wikipedia.</p>"},{"location":"miscellaneous_info/#limitations-of-meinberg-card","title":"Limitations of Meinberg Card","text":"<p>The meinberg card seems to be limited to rates of ~2.5KHz. While this is not a critical (run ending) issue, the meinberg will have to \"catch up\" at the end of runs. It may also need to be removed from the event buider (i.e. change the buffer it writes on to something that doesn't include \"BUF\" at the beginning).</p> <p>In a study performed on the meinberg card, we found it behaves strangley at high rates. Sometimes it \"misses\" events and sometimes is has long wait periods. See the plots below.</p> <p></p> <p></p>"},{"location":"miscellaneous_info/#port-forwarding-an-ssh-connection","title":"Port Forwarding an SSH Connection","text":"<p>In many cases, you will need to access a web server running on a remote machine that has no Graphical User Interface (GUI). This can be done securely using SSH port forwarding. Below are instructions for setting up port forwarding on a RHEL Linux machine so you can view a webpage served on <code>localhost:8080</code> from your local machine with a GUI (ex. laptop).</p>"},{"location":"miscellaneous_info/#prerequisites","title":"Prerequisites","text":"<ul> <li>SSH access to the remote RHEL Linux machine.</li> <li>An SSH client on your local machine. e.g. <code>ssh</code> command in a terminal, (you can also use PuTTY on Windows though I would not recommend this; you can still use ssh on windows).</li> <li>Ensure the remote machine is configured to allow SSH connections. The SSH service should be running, and the firewall should permit SSH traffic (usually on port 22).</li> </ul>"},{"location":"miscellaneous_info/#instructions","title":"Instructions","text":"<p>1 Ensure SSH service is running on the remote machine:</p> <pre><code>sudo systemctl start sshd\nsudo systemctl enable sshd\n</code></pre> <p>2 Configure the firewall to allow SSH connections on the remote machine:</p> <pre><code>    sudo firewall-cmd --permanent --add-service=ssh\n    sudo firewall-cmd --reload\n</code></pre> <p>3 Open a terminal on your local machine.</p> <p>4 Establish an SSH connection with port forwarding:</p> <p>Use the following command to create an SSH tunnel. Replace <code>user</code> with your username on the remote machine and <code>remote_host</code> with the IP address or hostname of the remote machine.</p> <pre><code>ssh -L 8080:localhost:8080 user@remote_host\n</code></pre> <p>This command forwards your laptop's port <code>8080</code> to the remote machine's port <code>8080</code>. Here's a breakdown of the command:</p> <ul> <li><code>-L 8080:localhost:8080</code>: Specifies the local port (<code>8080</code>) to be forwarded to the remote port (<code>8080</code> on <code>localhost</code> of the remote machine).</li> <li><code>user@remote_host</code>: The SSH login to the remote machine.</li> </ul> <p>5 Access the webpage:</p> <p>Open a web browser on your laptop and navigate to:</p> <pre><code>http://localhost:8080\n</code></pre> <p>You should see the webpage served by the remote machine on port <code>8080</code>.</p>"},{"location":"miscellaneous_info/#example","title":"Example","text":"<p>If you want to access the root user on a machine with IP 192.168.50.10:</p> <pre><code>ssh -L 8080:localhost:8080 root@192.168.50.10\n</code></pre> <p>After running this command, open a browser on your laptop and go to <code>http://localhost:8080</code> to view the webpage hosted on the remote machine.</p>"},{"location":"miscellaneous_info/#notes","title":"Notes","text":"<ul> <li>Ensure that the web server on the remote machine is configured to listen on <code>localhost:8080</code> and is running.</li> <li>If port <code>8080</code> is already in use on your local machine, you can use a different local port (e.g., <code>9090</code>) by changing the command to <code>-L 9090:localhost:8080</code> and then accessing <code>http://localhost:9090</code> on your laptop.</li> </ul> <p>This setup allows you to securely access the web server running on your remote RHEL machine from your local laptop using SSH port forwarding.</p>"},{"location":"miscellaneous_info/#2023-psi-lyso-testbeam-daq-installer","title":"2023 PSI LYSO Testbeam DAQ Installer","text":"<p>There is a gm2daq-installer that has been tested on RHEL7 systems. This will attempt to install the listed packages below. This installer's purpose was to streamline installation of the 2023 PSI LYSO testbeam usage of the DAQ. WARNING: As some of these packages have been updated, the installer may fail. Use this at your own disgression. In particular, I don't expect the unpacker, publisher, meinberg, and gm2daq software to install correctly. If you use this tool, it would be best to install those by hand if needed by following the links. Furthermore on RHEL9 systems (such as ALMA9) , the distributed pre-compiled binaries are more up to date, which simplifies the installation process greatly. As a result, I would only suggest using the installer for RHEL7 systems (such as SL7 or CentOS7).</p> <p>To attempt to install everything with the installer:</p> <pre><code>git clone git@github.com:PIONEER-Experiment/gm2daq-installer.git\ncd gm2daq-installer\n./install.sh\n</code></pre>"},{"location":"miscellaneous_info/#list-of-installed-software","title":"List of Installed Software","text":"<p>If you navigate to</p> <pre><code>cd gm2daq-installer/subprocess_scripts\n</code></pre> <p>you can install packages individually:</p> Script Name Description <code>install_epel-release.sh</code> Installs EPEL Release <code>install_openssl-devel.sh</code> Installs OpenSSL Development Libraries <code>install_cmake.sh</code> Installs CMake <code>install_cmake3.sh</code> Installs CMake3 <code>install_readline.sh</code> Installs Readline Development Tools <code>install_root.sh</code> Installs ROOT (pre-compiled binary) <code>install_erlang.sh</code> Installs Erlang <code>install_zlib.sh</code> Installs zlib Development Libraries <code>install_devtoolset-8.sh</code> Installs Devtoolset-8 <code>install_devtoolset-11.sh</code> Installs Devtoolset-11 <code>install_rh-python36.sh</code> Installs Python 3.6 <code>install_libXft.sh</code> Installs libXft Development Libraries <code>install_libXpm.sh</code> Installs libXpm Development Libraries <code>install_libXt.sh</code> Installs libXt Development Libraries <code>install_libXext.sh</code> Installs libXext Development Libraries <code>install_patch.sh</code> Installs Patch Development Tools <code>install_libtool.sh</code> Installs Libtool Development Tools <code>install_meinberg_driver.sh</code> Installs Meinberg Driver <code>install_midas.sh</code> Installs MIDAS <code>install_pugixml.sh</code> Installs pugixml Development Libraries <code>install_boost_1_53_0.sh</code> Installs Boost 1.53.0 <code>install_cactus.sh</code> Installs Cactus <code>install_gm2daq.sh</code> Installs gm2daq <code>install_root_from_source.sh</code> Installs ROOT (from source) <code>install_boost_1_70_0.sh</code> Installs Boost 1.70.0 <code>install_zeroMQ.sh</code> Installs ZeroMQ Development Libraries <code>install_cppzmq.sh</code> Installs C++ ZeroMQ <code>install_eigen.sh</code> Installs Eigen Development Libraries <code>install_unpacker.sh</code> Installs Midas Data File Unpacker <code>install_publisher.sh</code> Installs Midas Data Publisher <p>you can also run</p> <pre><code>./install.sh --skip root_from_source,zeroMQ,...\n</code></pre> <p>to skip certain packages, for example. From the list above, remove the <code>install_</code> and <code>.sh</code> parts and add it to the comma seperated list following the <code>--skip</code> flag to skip it. For instance, I would recommend trying:</p>"},{"location":"miscellaneous_info/#fc7-labeling","title":"FC7 Labeling","text":"<p>These labelings are particularly useful when configuring the CCC ODB settings</p>"},{"location":"miscellaneous_info/#using-screens-in-linux","title":"Using Screens in Linux","text":"<p>Screens are useful for running the DAQ because it allows you start and view multiple frontends on one terminal. You can read more on this webpage for example. Below are a few useful screen commands:</p>"},{"location":"miscellaneous_info/#starting-a-screen","title":"Starting a Screen","text":"<pre><code>screen -S &lt;session_name&gt;\n</code></pre>"},{"location":"miscellaneous_info/#listing-screens","title":"Listing Screens","text":"<pre><code>screen -ls\n</code></pre>"},{"location":"miscellaneous_info/#stopping-a-screen","title":"Stopping a Screen","text":"<p>To stop a screen session, first list all sessions to find the session ID:</p> <pre><code>screen -ls\n</code></pre> <p>Then, stop the desired screen session:</p> <pre><code>screen -X -S &lt;session_id&gt; quit\n</code></pre>"},{"location":"miscellaneous_info/#attaching-to-a-screen","title":"Attaching to a Screen","text":"<pre><code>screen -r &lt;session_name&gt;\n</code></pre>"},{"location":"miscellaneous_info/#detaching-from-a-screen","title":"Detaching from a Screen","text":"<p>To detach from a screen session you have attached to, press <code>Ctrl + a</code> and <code>d</code>. This will return you to your previous shell session.</p>"},{"location":"miscellaneous_info/#scrolling-up-in-a-screen","title":"Scrolling up in a Screen","text":"<p>To scroll up in a screen session, press <code>Ctrl + a</code> and then <code>[</code>. Use the arrow keys to navigate. To exit scroll mode, press <code>q</code>.</p>"},{"location":"miscellaneous_info/#getting-ld_library_path-into-a-screen-session","title":"Getting <code>LD_LIBRARY_PATH</code> Into a Screen Session","text":"<p>For some reason, stuffing <code>LD_LIBRARY_PATH</code> into a screen session is convoluted. To copy your current shell sessions <code>LD_LIBRARY_PATH</code> environment variable into a screen session, you need to edit your <code>.screenrc</code> file for the profile you launch the screen from. Simply run these two commands:</p> <pre><code>touch ~/.screenrc\necho 'shell -/bin/bash -c \"export LD_LIBRARY_PATH=$LD_LIBRARY_PATH &amp;&amp; exec /bin/bash\"' &gt;&gt; ~/.screenrc\n</code></pre> <p>Now for every new screen session, your <code>LD_LIBRARY_PATH</code> environment variable will be copied over from your current shell session to the new screen session. This is useful when you have custom libraries added to your <code>LD_LIBRARY_PATH</code>; the environment setup script used in the DAQ installation guide adds some custom libraries <code>LD_LIBRARY_PATH</code>.</p>"},{"location":"miscellaneous_info/#the-nat-mch","title":"The N.A.T. MCH","text":""},{"location":"miscellaneous_info/#overview","title":"Overview","text":"<p>An alternative to the VadaTech MCH, it has the same functionality.</p>"},{"location":"miscellaneous_info/#configuration","title":"Configuration","text":"<p>See NAT MCH manual for more details. Depending on the NAT MCH version, you may be able to ssh into the NAT MCH.</p> <p>In any event, you can configure the NAT MCH with <code>telnet</code></p> <pre><code>sudo yum install telnet\ntelnet 192.68.1.41\n</code></pre> <p>From there you can follow the prompts to configure the NAT MCH. If you are having trouble finding the NAT MCH IP try pinging or scanning the network.</p>"},{"location":"miscellaneous_info/#finisar-sfp-vs-avago-sfp","title":"Finisar SFP vs. Avago SFP+","text":"<p>SFP+s (such as Avago SFP+s) do not work with the FC7 to AMC13 link; an SFP (such as a finisar SFP) is needed. Similarly, the 10GbE links from AMC13 to the DAQ computer must use SFP+s.</p>"},{"location":"miscellaneous_info/#bank-signals","title":"Bank Signals","text":"<p>Copies of D0-D3 triggers are sent out of D0-D3, while D4-D7 should be configured to be input signals. The trigger input should go to D6 (It does not have to be 1kHz). A 40MHz clock should go in D7.</p>"},{"location":"miscellaneous_info/#centos7-related-installation-steps","title":"CentOS7 Related Installation Steps","text":"<p>CentOS7 has reached it's EOL. Many of these steps will no longer work because package manager repo links are dead. They are here for legacy referencing purposes only.</p>"},{"location":"miscellaneous_info/#development-tools","title":"Development Tools","text":""},{"location":"miscellaneous_info/#overview_1","title":"Overview","text":"<p>These tools include compilers, libraries, and other utilities that facilitate software development and installation.</p>"},{"location":"miscellaneous_info/#installation-guide","title":"Installation Guide","text":"<p>1 Install yum package manager</p> <pre><code>sudo dnf install yum\n</code></pre> <p>2 Update the package index:</p> <pre><code>sudo yum update\n</code></pre> <p>3 Enable the EPEL repository:</p> <pre><code>sudo yum install epel-release\n</code></pre> <p>4 Install Development Tools and Dependencies:</p> <pre><code>sudo yum groupinstall \"Development Tools\"\nsudo yum install cmake gcc-c++ gcc binutils libX11-devel libXpm-devel libXft-devel libXext-devel\n</code></pre> <p>5 Install Python</p> <pre><code>sudo yum install python3\n</code></pre> <p>Note: CentOS7 may not have python3 available in base repositories, you can install via <code>yum install -y rh-python36</code>.</p>"},{"location":"miscellaneous_info/#root","title":"ROOT","text":""},{"location":"miscellaneous_info/#overview_2","title":"Overview","text":"<p>ROOT is an open-source data analysis framework developed by CERN. It is widely used in high-energy physics for data processing, statistical analysis, visualization, and storage. It is needed for some features of Midas.</p>"},{"location":"miscellaneous_info/#installation-guide-build-from-source","title":"Installation Guide (Build from source)","text":"<p>General installaiton guides are provided by ROOT at their Installing ROOT and Building ROOT from source pages.</p> <p>1 Example building latest stable branch from source</p> <pre><code>git clone --branch latest-stable --depth=1 https://github.com/root-project/root.git root_src\nmkdir root_build root_install &amp;&amp; cd root_build\ncmake -DCMAKE_INSTALL_PREFIX=../root_install ../root_src # &amp;&amp; check cmake configuration output for warnings or errors\ncmake --build . -- install -j4 # if you have 4 cores available for compilation\nsource ../root_install/bin/thisroot.sh # or thisroot.{fish,csh}\n</code></pre> <p>Note: Adjust the ROOT version and the download URL as needed. Always check for the latest version on the official ROOT website. Furthermore, if you are not building from source you are installing precompiled binaries, which may not be up to date versions of ROOT. For specific versions, you may need to build root from source.</p>"},{"location":"miscellaneous_info/#ipbus-cactus","title":"IPBus (Cactus)","text":""},{"location":"miscellaneous_info/#overview_3","title":"Overview","text":"<p>IPBus, part of the Cactus framework, is a protocol for remote control and monitoring of hardware devices over Ethernet. It's commonly used in high-energy DAQ systems.</p>"},{"location":"miscellaneous_info/#installation-guide_1","title":"Installation Guide","text":"<p>1 Remove previous version (if applicable):</p> <pre><code>sudo yum groupremove uhal\n</code></pre> <p>2 Download yum repo file:</p> <pre><code>sudo curl https://ipbus.web.cern.ch/doc/user/html/_downloads/ipbus-sw.centos7.repo -o /etc/yum.repos.d/ipbus-sw.repo\n</code></pre> <p>3 Install uHAL:</p> <pre><code>sudo yum clean all\nsudo yum groupinstall uhal\n</code></pre> <p>Note: I personally had trouble getting this to work on CentOS7 and had to resort to building from source (see below).</p>"},{"location":"miscellaneous_info/#example-building-from-source","title":"Example building from source","text":"<p>See Compiling and installing from source, an example is below:</p> <pre><code>sudo yum install pugixml-devel\ngit clone --depth=1 -b v2.7.3 --recurse-submodules https://github.com/ipbus/ipbus-software.git\ncd ipbus-software\nmake -j$(nproc) EXTERN_BOOST_INCLUDE_PREFIX=\"/opt/boost/include\" EXTERN_BOOST_LIB_PREFIX=\"/opt/boost/lib\" EXTERN_PUGIXML_INCLUDE_PREFIX=\"/usr/local/include\" EXTERN_PUGIXML_LIB_PREFIX=\"/usr/local/lib64/\"\nsudo make install -j$(nproc)\n</code></pre> <p>Note: You may not need to specify <code>EXTERN_BOOST_INCLUDE_PREFIX</code>, <code>EXTERN_BOOST_LIB_PREFIX</code>, <code>EXTERN_PUGIXML_INCLUDE_PREFIX</code>, <code>EXTERN_PUGIXML_LIB_PREFIX</code>. Otherwise, you may need to find where pugixml and boost were installed and replace the paths above respectively.</p>"},{"location":"miscellaneous_info/#old-network-scripts","title":"Old Network Scripts","text":"<p>Network scripts are a deprecated feature of red hat linux systems. Now, a connection manager is used via <code>nmcli</code> commands. For reference, the old network scripts are here.</p>"},{"location":"miscellaneous_info/#mch-network-script-example","title":"MCH Network script example","text":"<pre><code>vi /etc/sysconfig/network-scripts/ifcfg-{port name}\n</code></pre> <p>For example, this is how the UKY teststand 1GbE NIC is configured to communicate with multiple crate using an ethernet splitter.</p> <pre><code>#\n# Connect to MCH\n#\nTYPE=Ethernet\nBOOTPROTO=static\nIPADDR=192.168.1.100\nNETMASK=255.255.0.0\nIPV4_FAILURE_FATAL=no\nIPV6INIT=no\nIPV6_AUTOCONF=yes\nIPV6_DEFROUTE=yes\nIPV6_PEERDNS=yes\nIPV6_PEERROUTES=yes\nIPV6_FAILURE_FATAL=no\nNAME=enp5s0\nDEVICE=enp5s0\nONBOOT=yes\n</code></pre> <p>In particular, the <code>IP_ADDR</code> and <code>NETMASK</code> sections are important. Here the port is specified to accept any traffic on the 192.168.51.xxx subnet. See the networking page for more details.</p>"},{"location":"miscellaneous_info/#amc13-network-script-example","title":"AMC13 Network script example","text":"<pre><code>vi /etc/sysconfig/network-scripts/ifcfg-{port name}\n</code></pre> <p>For example, this is how one of the UKY teststand 10GbE NIC is configured to communicate with the AMC13.</p> <pre><code>#\n# Connect to AMC13\n#\nTYPE=Ethernet\nBOOTPROTO=static\nIPADDR=192.168.51.100\nNETMASK=255.255.255.0\nIPV4_FAILURE_FATAL=no\nIPV6INIT=no\nIPV6_AUTOCONF=yes\nIPV6_DEFROUTE=yes\nIPV6_PEERDNS=yes\nIPV6_PEERROUTES=yes\nIPV6_FAILURE_FATAL=no\nNAME=enp1s0f0\nDEVICE=enp1s0f0\nONBOOT=yes\nAUTOCONNECT_PRIORITY=-999\nMTU=9000\n</code></pre> <p>In particular, the <code>IP_ADDR</code>, <code>NETMASK</code>, and <code>MTU</code> sections are important. Here the port is specified to accept any traffic on the 192.168.51.xxx subnet. See the networking page for more details.</p>"},{"location":"miscellaneous_info/#python2","title":"Python2","text":""},{"location":"miscellaneous_info/#overview_4","title":"Overview","text":"<p>Some scripts are written for configuring the DAQ are written in python2. To install python2 on ALMA9, you must install from source. Afterwards, you can run python2 scripts with <code>python2.7 {script name}</code>. Using python2 is not recommended due to it reaching it's EOL some time ago. It's better to manually edit this scripts run using python3</p>"},{"location":"miscellaneous_info/#installation-guide_2","title":"Installation Guide","text":"<p>1 Install required dependencies </p> <p>First, ensure that the system has the necessary development tools and libraries for compiling Python from source:</p> <pre><code>sudo dnf groupinstall -y \"Development Tools\"\nsudo dnf install -y gcc openssl-devel bzip2-devel libffi-devel zlib-devel\n</code></pre> <p>2 Download Python 2.7.18 source code </p> <p>Next, download the Python 2.7.18 tarball, which is the last stable version of Python 2</p> <pre><code>cd /path/to/packages\nwget https://www.python.org/ftp/python/2.7.18/Python-2.7.18.tgz\n</code></pre> <p>3 Extract and compile Python </p> <p>Extract the downloaded tarball, configure the build environment, and compile Python</p> <pre><code>tar xzf Python-2.7.18.tgz\ncd Python-2.7.18\n./configure --enable-optimizations\nmake\n</code></pre> <p>Note: During the tests, I experienced some errors. I was able to <code>Ctrl-C</code> to cancel these and continue without errors</p> <p>4 Install Python 2.7 </p> <p>Install the compiled version of Python 2.7 on your system:</p> <pre><code>sudo make altinstall\n</code></pre> <p>Using <code>altinstall</code> ensures that the new version does not overwrite the default <code>python</code> command on your system.</p> <p>5 Verify installation </p> <pre><code>python2.7 --version\n</code></pre> <p>6 Cleanup: </p> <pre><code>rm -rf Python-2.7.18.tgz\nrm -rf Python-2.7.18\n</code></pre>"},{"location":"networking/","title":"Networking Basics","text":"<p>To network the DAQ hardware together, understanding basic concepts such as IP addressing, subnetting, and network interfaces is crucial. This page will introduce you to fundamental networking terms in linux.</p>"},{"location":"networking/#reading-network-port-information","title":"Reading Network Port Information","text":"<p>On linux systems, you can use the command <code>ifconfig</code> to list all active ports on the system and some information about them. Below is an example.</p>"},{"location":"networking/#example-ifconfig-output","title":"Example <code>ifconfig</code> Output","text":"<pre><code>eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500\n        inet 192.168.1.100  netmask 255.255.240.0  broadcast 192.168.1.255\n        inet6 fe80::215:5dff:fe8f:7013  prefixlen 64  scopeid 0x20&lt;link&gt;\n        ether 00:15:5d:8f:70:13  txqueuelen 1000  (Ethernet)\n        RX packets 38935  bytes 56933483 (56.9 MB)\n        RX errors 0  dropped 0  overruns 0  frame 0\n        TX packets 5766  bytes 471459 (471.4 KB)\n        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0\n</code></pre>"},{"location":"networking/#explanation","title":"Explanation:","text":"<p>Interface Name (<code>eth0</code>):</p> <ul> <li>This is the name of the network interface.</li> </ul> <p>Flags:</p> <ul> <li> <p><code>UP</code>: Indicates that the network interface is currently enabled and operational. When an interface is \"up,\" it means the operating system has activated it and it is ready to send and receive data.</p> </li> <li> <p><code>BROADCAST</code>: This flag signifies that the network interface supports broadcasting. Broadcasting allows a single packet to be sent to all devices within the same subnet. Devices use broadcast addresses to receive these packets.</p> </li> <li> <p><code>RUNNING</code>: Indicates that the network interface is operational and actively sending or receiving data. It confirms that the interface is functioning correctly and is capable of transferring data packets.</p> </li> <li> <p><code>MULTICAST</code>: Indicates that the network interface supports multicasting. Multicasting allows a single packet to be sent to multiple specific recipients who have joined a multicast group. It is more efficient than broadcasting for sending data to multiple destinations simultaneously.</p> </li> </ul> <p>MTU (<code>mtu 1500</code>):</p> <ul> <li>Maximum Transmission Unit, the largest packet size in bytes.</li> <li>Default is usually 1500 bytes.</li> <li>For 10GbE links, this must be increased for efficiency. Typically to ~9000 bytes.</li> </ul> <p>IPv4 Address (<code>inet 192.168.1.100</code>):</p> <ul> <li>IP address assigned to the interface.</li> </ul> <p>Netmask (<code>netmask 255.255.255.0</code>):</p> <ul> <li>Defines the network portion of the IP address.</li> </ul> <p>Broadcast Address (<code>broadcast 192.168.1.255</code>):</p> <ul> <li>Address used for broadcasting messages.</li> </ul> <p>RX (Receive) and TX (Transmit) Packets:</p> <ul> <li>Count of packets received and transmitted.</li> </ul> <p>RX (Receive) and TX (Transmit) Bytes:</p> <ul> <li>Total bytes received and transmitted.</li> </ul>"},{"location":"networking/#using-nmcli-command-line-tools","title":"Using <code>nmcli</code> Command Line Tools","text":"<p>In Red Hat-based Linux systems (like Alma, CentOS, Fedora, or RHEL), you can use the <code>nmcli</code> command line tool to configure network interfaces. <code>nmcli</code> interacts with NetworkManager and allows you to configure network settings directly from the terminal without editing configuration files manually.</p>"},{"location":"networking/#example-nmcli-configuration-enp5s0-interface","title":"Example <code>nmcli</code> Configuration: <code>enp5s0</code> Interface","text":"<pre><code>nmcli connection add type ethernet con-name enp5s0 ifname enp5s0 \\\n    ipv4.addresses 192.168.1.100/24 \\\n    ipv4.method manual \\\n    ipv4.gateway 192.168.1.1 \\\n    802-3-ethernet.mtu 1500 \\\n    connection.autoconnect yes\n</code></pre>"},{"location":"networking/#explanation_1","title":"Explanation:","text":"<ul> <li> <p><code>type ethernet</code>: Specifies that the connection type is Ethernet. This parameter indicates that you are configuring a wired network interface.</p> </li> <li> <p><code>con-name enp5s0</code>: Defines the connection name (<code>enp5s0</code>). This is the name used to refer to the connection in <code>nmcli</code>. It's often the name of the network interface (e.g., <code>enp5s0</code>).</p> </li> <li> <p><code>ifname enp5s0</code>: Specifies the name of the network interface (<code>enp5s0</code>) that the connection applies to. This should match the actual name of the interface as listed by <code>nmcli device</code>.</p> </li> <li> <p><code>ipv4.addresses 192.168.1.100/24</code>: Sets the static IPv4 address (<code>192.168.1.100</code>) with the subnet mask (<code>/24</code>). This defines the IP address for the network interface and its subnet.</p> </li> <li> <p><code>ipv4.method manual</code>: Specifies that the IP address configuration is static. This will prevent NetworkManager from using DHCP to obtain an IP address.</p> </li> <li> <p><code>ipv4.gateway 192.168.1.1</code>: Defines the default gateway (<code>192.168.1.1</code>) for the interface. This is the IP address of the router or gateway used to route traffic to external networks.</p> </li> <li> <p><code>802-3-ethernet.mtu 1500</code>: Sets the Maximum Transmission Unit (MTU) to <code>1500</code> bytes. This defines the largest packet size that can be transmitted without fragmentation.</p> </li> <li> <p><code>connection.autoconnect yes</code>: Ensures that the network connection is automatically activated during system boot or when the interface is brought up.</p> </li> </ul>"},{"location":"networking/#additional-commands-for-managing-the-connection","title":"Additional Commands for Managing the Connection","text":"<p>Show the active connections:</p> <pre><code>nmcli connection show\n</code></pre> <p>Modify an existing connection:</p> <pre><code>nmcli connection modify enp5s0 ipv4.addresses 192.168.1.101/24\n</code></pre> <p>This changes the IP address of the <code>enp5s0</code> connection to <code>192.168.1.101</code>.</p> <p>Delete a connection:</p> <pre><code>nmcli connection delete enp5s0\n</code></pre> <p>Bring the connection up or down:</p> <pre><code>nmcli connection up enp5s0\nnmcli connection down enp5s0\n</code></pre> <p>Check the status of the connection:</p> <pre><code>nmcli device status\n</code></pre>"},{"location":"networking/#using-network-scripts","title":"Using Network Scripts","text":"<p>In Red Hat-based Linux systems (like Alma, CentOS, Fedora, or RHEL), network interfaces are often configured using <code>ifcfg</code> files located in <code>/etc/sysconfig/network-scripts/</code>. These files contain key configuration parameters that define how network interfaces behave and interact with the network. This is a deprecated feature. Modern RHEL systems use nmcli. Nonetheless, some of our older electronics still use networks scripts.</p>"},{"location":"networking/#example-ifcfg-file-etcsysconfignetwork-scriptsifcfg-eth0","title":"Example <code>ifcfg</code> File: <code>/etc/sysconfig/network-scripts/ifcfg-eth0</code>","text":"<pre><code>DEVICE=eth0\nBOOTPROTO=static\nONBOOT=yes\nIPADDR=192.168.1.100\nNETMASK=255.255.255.0\nGATEWAY=192.168.1.1\nMTU=1500\n</code></pre>"},{"location":"networking/#explanation_2","title":"Explanation:","text":"<ul> <li> <p><code>DEVICE=eth0</code>: Specifies the network interface name (<code>eth0</code>). This parameter identifies which network interface the configuration applies to.</p> </li> <li> <p><code>BOOTPROTO=static</code>: Defines the method used to configure the IP address. <code>static</code> indicates that the IP address is manually configured rather than assigned dynamically (e.g., via <code>DHCP</code>).</p> </li> <li> <p><code>ONBOOT=yes</code>: Ensures that the network interface (<code>eth0</code>) is automatically activated during system boot. Setting this to <code>yes</code> ensures the interface is brought up when the system starts.</p> </li> <li> <p><code>IPADDR=192.168.1.100</code>: Sets the static IPv4 address (<code>192.168.1.100</code>) for the <code>eth0</code> interface. Replace this with the desired IP address for your network configuration.</p> </li> <li> <p><code>NETMASK=255.255.255.0</code>: Specifies the subnet mask (<code>255.255.255.0</code>) associated with the IP address. The subnet mask determines which part of the IP address is the network portion and which part is the host portion.</p> </li> <li> <p><code>GATEWAY=192.168.1.1</code>: Defines the default gateway (<code>192.168.1.1</code>) for the network interface. The gateway is used for routing traffic to destinations outside the local subnet.</p> </li> <li> <p><code>MTU=1500</code>: Sets the Maximum Transmission Unit (MTU) to <code>1500</code> bytes for the <code>eth0</code> interface. MTU defines the largest packet size that can be transmitted over the network interface without fragmentation.</p> </li> </ul>"},{"location":"networking/#subnet-masks-and-network-ranges","title":"Subnet Masks and Network Ranges","text":"<p>Masks are very important for segmenting your network so traffic is routed appropriately. There are two notations to do this:</p> <ol> <li>Subnet masks like <code>255.255.255.0</code></li> <li>CIDR notation like <code>/24</code> Both of these do the same thing, but you'll see both used \"in the wild.\"</li> </ol>"},{"location":"networking/#subnet-mask-2552552550-cidr-24","title":"Subnet Mask <code>255.255.255.0</code> (CIDR <code>/24</code>):","text":"<ul> <li>Explanation: This subnet mask (<code>255.255.255.0</code>) allows for up to 254 usable IP addresses within the same network.</li> </ul>"},{"location":"networking/#example-with-network-1921681xxx","title":"Example with Network <code>192.168.1.xxx</code>:","text":"<ul> <li> <p>Network Address: <code>192.168.1.0/24</code></p> <ul> <li>Range of IP Addresses: <code>192.168.1.1</code> to <code>192.168.1.254</code></li> <li>Subnet Mask: <code>255.255.255.0</code></li> </ul> </li> <li> <p>Usage: </p> <ul> <li>This subnet mask divides the IP address <code>192.168.1.0</code> into a network portion (<code>192.168.1</code>) and a host portion (<code>xxx</code>). The last octet (<code>xxx</code>) ranges from <code>1</code> to <code>254</code>, with <code>0</code> reserved as the network address and <code>255</code> reserved as the broadcast address.</li> </ul> </li> </ul>"},{"location":"networking/#subnet-mask-25525500-cidr-16","title":"Subnet Mask <code>255.255.0.0</code> (CIDR <code>/16</code>):","text":"<ul> <li>Explanation: This subnet mask (<code>255.255.0.0</code>) allows for up to 65,534 usable IP addresses within the same network.</li> </ul>"},{"location":"networking/#example-with-network-192168xxxxxx","title":"Example with Network <code>192.168.xxx.xxx</code>:","text":"<ul> <li> <p>Network Address: <code>192.168.0.0/16</code></p> <ul> <li>Range of IP Addresses: <code>192.168.0.1</code> to <code>192.168.255.254</code></li> <li>Subnet Mask: <code>255.255.0.0</code></li> </ul> </li> <li> <p>Usage: </p> <ul> <li>This subnet mask divides the IP address <code>192.168.0.0</code> into a network portion (<code>192.168</code>) and two host portions (<code>xxx.xxx</code>). The third and fourth octets (<code>xxx.xxx</code>) range from <code>0.1</code> to <code>255.254</code>, with <code>0.0</code> reserved as the network address and <code>255.255</code> reserved as the broadcast address.</li> </ul> </li> </ul>"},{"location":"networking/#additional-examples","title":"Additional Examples:","text":""},{"location":"networking/#subnet-mask-255000-cidr-8","title":"Subnet Mask <code>255.0.0.0</code> (CIDR <code>/8</code>):","text":"<ul> <li> <p>Example: </p> <ul> <li>Network Address: <code>192.0.0.0/8</code></li> <li>Range of IP Addresses: <code>192.0.0.1</code> to <code>192.255.255.254</code></li> <li>Subnet Mask: <code>255.0.0.0</code></li> </ul> </li> <li> <p>Usage: </p> <ul> <li>This subnet mask divides the IP address <code>192.0.0.0</code> into a network portion (<code>192</code>) and three host portions (<code>xxx.xxx.xxx</code>). The second, third, and fourth octets (<code>xxx.xxx.xxx</code>) range from <code>0.0.1</code> to <code>255.255.254</code>, with <code>0.0.0.0</code> reserved as the network address and <code>255.255.255.255</code> reserved as the broadcast address.</li> </ul> </li> </ul>"},{"location":"networking/#subnet-mask-2552551280-cidr-17","title":"Subnet Mask <code>255.255.128.0</code> (CIDR <code>/17</code>):","text":"<ul> <li> <p>Example: </p> <ul> <li>Network Address: <code>192.168.0.0/17</code></li> <li>Range of IP Addresses: <code>192.168.0.1</code> to <code>192.168.127.254</code></li> <li>Subnet Mask: <code>255.255.128.0</code></li> </ul> </li> <li> <p>Usage: </p> <ul> <li>This subnet mask divides the IP address <code>192.168.0.0</code> into a network portion (<code>192.168.0</code>) and a host portion (<code>xxx</code>). The third octet (<code>0.xxx</code>) ranges from <code>0.1</code> to <code>127.254</code>, with <code>0.0</code> reserved as the network address and <code>127.255</code> reserved as the broadcast address.</li> </ul> </li> </ul>"},{"location":"networking/#scanning-a-network","title":"Scanning a network","text":"<p>To identify devices and their IP addresses on your network, you can use various tools available on Linux. One of the most common tools for network scanning is <code>nmap</code>.</p>"},{"location":"networking/#using-nmap","title":"Using <code>nmap</code>","text":"<p>1 Install <code>nmap</code>: If <code>nmap</code> is not already installed on your system, you can install it using the package manager for Red Hat-based distributions.</p> <pre><code>sudo yum install nmap\n</code></pre> <p>2 Scan the Network: To scan your local network and list all active devices, use the following command. Replace <code>192.168.1.0/24</code> with your network range.</p> <pre><code>sudo nmap -sP 192.168.1.0/24\n</code></pre> <p>This example performs a \"ping scan\" on the network 192.168.1.1 - 192.168.1.254. This may take a while to complete as it has to can ~2^8 IP addresses.</p> <p>Another example:</p> <pre><code>sudo nmap -sP 192.168.0.0/16\n</code></pre> <p>This example performs a \"ping scan\" on the network 192.168.1.1 - 192.168.1.254. This will take even longer to complete as it has to scan ~2^16 IP addresses. As a result, it might be best to screen the scan in the background and write the results to a file:</p> <pre><code>screen -dmS nmap_scan bash -c 'sudo nmap -sP 192.168.0.0/24 &gt; ~/nmap_scan_results.txt'\n</code></pre>"},{"location":"networking/#using-arp-scan","title":"Using <code>arp-scan</code>","text":"<p>1 Install <code>arp-scan</code>:</p> <p>Another useful tool for network scanning is arp-scan. This tool can also help you discover devices on your network.</p> <pre><code>sudo yum install arp-scan\n</code></pre> <p>2 Scan the Network:</p> <pre><code>sudo arp-scan --interface=eth0 --localnet\n\n</code></pre> <p>Replace the interface with the appropriate device name for your network. You can check this using <code>ifconfig</code>.</p>"},{"location":"odb_config/","title":"Midas Online Data Base (ODB) Configuration","text":""},{"location":"odb_config/#odb-basics","title":"ODB basics","text":"<p>Below are some basic usage examples of midas' ODB</p>"},{"location":"odb_config/#accessing-the-odb","title":"Accessing the ODB","text":""},{"location":"odb_config/#command-line-interface","title":"Command line interface","text":"<p>You can edit the ODB via command line without needing a midas webserver running.</p> <pre><code>$MIDASSYS/bin/odbedit\n</code></pre> <p>Then you can navigate through the ODB as you would with linux directory commands. From here, you can type \"help\" or view the odbedit command list for a list of commands.</p>"},{"location":"odb_config/#via-midas-webpage","title":"Via Midas Webpage","text":"<p>You can start a midas webpage by running <code>mhttpd</code> (or <code>mhttpd6</code>)</p> <pre><code>$MIDASSYS/bin/mhttpd\n</code></pre> <p>Then view the ODB by clicking the ODB button on the left sidebar</p>"},{"location":"odb_config/#general-odb-configuration-examples","title":"General ODB Configuration Examples","text":"<p>For a general guide on how to use Midas' ODB, see the ODB Access and Use wiki page. Below are a few of common ODB</p>"},{"location":"odb_config/#toggle-logger-data-writing","title":"Toggle Logger Data Writing","text":"Field Description Path <code>/Logger/Write Data</code> Description Whether or not the Logger will write data Valid Values <code>yes</code> or <code>no</code> Suggested Value <code>yes</code>"},{"location":"odb_config/#change-logger-data-writing-directory","title":"Change Logger Data Writing Directory","text":"Field Description Path <code>/Logger/Data dir</code> Description What directory the logger will write data to Valid Values any valid path Suggested Value <code>/path/to/your/online/directory</code> <p>Note: Change <code>/path/to/your/online/directory</code> to whatever directory you want to write data to</p>"},{"location":"odb_config/#change-data-buffer-logger-writes-to-file","title":"Change Data Buffer Logger Writes to File","text":"Field Description Path <code>/Logger/Channels/0/Settings/Buffer</code> Description What directory the logger will write data to Valid Values any valid buffer name (ex. <code>SYSTEM</code>, <code>BUF001</code>, ...) Suggested Value <code>SYSTEM</code>"},{"location":"odb_config/#toggle-logger-to-generate-odb-backups-for-each-run","title":"Toggle Logger to generate ODB backups for each run","text":"Field Description Path <code>/Logger/ODB Dump</code> Description Whether or not backups of the ODB will be generated after each run Valid Values <code>yes</code> or <code>no</code> Suggested Value <code>yes</code>"},{"location":"odb_config/#change-webpage-port","title":"Change Webpage Port","text":"Field Description Path <code>/WebServer/localhost port</code> Description What port the webserver will run on Valid Values <code>0000</code> to <code>9999</code> Suggested Value <code>8080</code> <p>Note: To generate this ODB path, run <code>mhttpd</code> or <code>mhttpd6</code> at least once. It doesn't need to be successful, it just needs to generate the <code>WebServer</code> ODB directory.</p>"},{"location":"odb_config/#disable-a-frontend","title":"Disable a Frontend","text":"Field Description Path <code>/Equipment/{Frontend Name}/Common/Enabled</code> Description Whether a frontend is enabled for use or not Valid Values <code>yes</code> or <code>no</code> Suggested Value <code>yes</code> <p>Note: Every Midas frontend generates a <code>Common</code> section it's ODB. For example, <code>Equipment/AMC13001/Common</code> will be generated. This is useful for toggling off crates in multicrate setups.</p>"},{"location":"odb_config/#change-the-data-buffer-for-a-frontend","title":"Change the Data Buffer for a Frontend","text":"Field Description Path <code>/Equipment/{Frontend Name}/Common/Buffer</code> Description What midas buffer the frontend will write to Valid Values <code>any valid string</code> Suggested Value <code>BUF{3 digit frontend #}</code> <p>Note: The event builder assumes every buffer for events starts with <code>BUF</code>. So it's best to name frontends <code>BUF</code> followed by their 3 digit frontend number. For example, for <code>AMC13001</code> frontend, <code>BUF001</code> is a good name.</p>"},{"location":"odb_config/#changing-run-number","title":"Changing Run Number","text":"Field Description Path <code>/Runinfo/Run number</code> Description The run the number for the experiment Valid Values <code>any valid integer</code> Suggested Value <code>1</code> <p>Note: If one decreases the run number, the logger will overwrite that run's data if a run is performed with the old run number again. For this reason, when loading and old ODB save you will want to increase the run number to a value larger than your last successful run number before taking data.</p>"},{"location":"odb_config/#g-2-modified-daq-specific-odb-configuration","title":"g-2 Modified DAQ Specific ODB Configuration","text":"<p>Below are some important settings in the ODB for the g-2 modified DAQ. This is not a complete description of every setting in the ODB. Many settings are artifacts from g-2 that don't serve any purpose anymore. You can find a script that will automatically set all these parameters to their suggested values in <code>scripts/apply_recommended_ODB_settings.py</code>.</p>"},{"location":"odb_config/#master-frontend-odb-settings","title":"Master Frontend ODB settings","text":""},{"location":"odb_config/#trigger-source","title":"Trigger Source","text":"Field Description Path <code>/Equipment/MasterGM2/Settings/Globals/Trigger Source</code> Description Determines what source the Master will use to trigger events Valid Values <code>GPS</code>, <code>PP</code> (currently broken), <code>Fake</code>, <code>Socket</code> (untested), <code>None</code>, <code>ODB</code>, and <code>FC7</code> Suggested Value <code>FC7</code> <p>Note: The meaning of each value is specified below:</p> <ul> <li> <p>GPS: Uses the Meinberg GPS timestamps for Master triggers.</p> </li> <li> <p>PP: Uses parallel port signals as the trigger source (currently broken).</p> </li> <li> <p>Fake: Uses a fake signal for testing purposes. Further configuration in ODB.</p> </li> <li> <p>Socket: Uses a socket connection as the trigger source (untested).</p> </li> <li> <p>None: No trigger source is used, no master triggers are made.</p> </li> <li> <p>ODB: Reads ODB to send triggers at a rate similar to the rate the AMC13 receives triggers.</p> </li> <li> <p>FC7: Uses FC7's trigger counter over IPMI to trigger events</p> </li> </ul>"},{"location":"odb_config/#front-end-offset","title":"Front End Offset","text":"Field Description Path <code>/Equipment/MasterGM2/Settings/Globals/Front End Offset</code> Description Offset for index for the IPs of the first frontend. For example if your MCH IP is 192.168.3.15, then you'd want this offset to be 3. Valid Values Positive integer &lt; 1000 Suggested Value <code>1</code>"},{"location":"odb_config/#encoder-front-end","title":"Encoder Front End","text":"Field Description Path <code>/Equipment/MasterGM2/Settings/Globals/Encoder Front End</code> Description Identifier for frontend that corresponds to the crate containing the encoder FC7 Valid Values <code>AMC13001</code>, <code>AMC13002</code>, ... Suggested Value <code>AMC13001</code>"},{"location":"odb_config/#amc13-readout-frontend-odb-settings","title":"AMC13 Readout Frontend ODB settings","text":"<p>Any setting not mentioned is either an artifact of g-2 (doesn't do anything) or shouldn't need to be modified from its default value. For example, most of the <code>TQ01</code>, <code>TQ02</code>, <code>TQ03</code>, and <code>TQ04</code> no longer function.</p>"},{"location":"odb_config/#send-to-event-builder","title":"Send to Event Builder","text":"Field Description Path <code>/Equipment/AMC13{frontend #}/Settings/Globals/Send to Event Builder</code> Description Defines whether or not data is sent to event builder frontend Valid Values <code>yes</code> or <code>no</code> Suggested Value <code>yes</code> <p>Note: It is best to have this set to <code>yes</code> as it won't affect data readout even if the event buidler isn't used.</p>"},{"location":"odb_config/#mch-ip-address","title":"MCH IP Address","text":"Field Description Path <code>/Equipment/AMC13{frontend #}/Settings/Globals/MCH IP Address</code> Description Set to MCH IP address for the MCH in this crate Valid Values Any valid IP address Suggested Value <code>192.168.1.15</code> <p>Note: This is the address in which the frontends sent IPMI commands to. If this is incorrect none of the crate components can be properly intialized for a data run. Each frontend (crate) should have it's own MCH IP address.</p>"},{"location":"odb_config/#ccc-fc7-slot-number-1-12","title":"CCC: FC7 Slot Number (1-12)","text":"Field Description Path <code>/Equipment/AMC13{frontend #}/Settings/Globals/CCC: FC7 Slot Number (1-12)</code> Description Slot number of the encoder FC7 in the uTCA crate Valid Values <code>1</code>, <code>2</code>, ... <code>12</code> Suggested Value <code>10</code> <p>Note: For crates without an FC7, this value does not matter. Just set it to the same value as the crate with the encoder FC7.</p>"},{"location":"odb_config/#ccc-fmc-location-topbottom","title":"CCC: FMC Location (top,bottom)","text":"Field Description Path <code>/Equipment/AMC13{frontend #}/Settings/Globals/CCC: FMC Location (top, bottom)</code> Description The location of the SFP interface FMC card on the FC7 board Valid Values <code>top</code> or <code>bottom</code> Suggested Value <code>top</code> <p>Note: See FC7 Labeling to decide whether your FMC SFP interface is on the top or the bottom (the FC7 firmware requires the SFP interface FMC is in the top slot).</p>"},{"location":"odb_config/#ccc-fmc-sfp-number-1-8","title":"CCC: FMC SFP Number (1-8)","text":"Field Description Path <code>/Equipment/AMC13{frontend #}/Settings/Globals/CCC: FMC SFP Number (1-8)</code> Description The FC7 SFP slot number this AMC13 is connected to by optical cable Valid Values <code>1</code>, <code>2</code>, ... <code>8</code> Suggested Value <code>1</code> (for the first crate) <p>Note: See FC7 Labeling to decide which port your optical connection is.</p>"},{"location":"odb_config/#amc13-10gbe-link-enable","title":"AMC13 10GbE Link Enable","text":"Field Description Path <code>/Equipment/AMC13{frontend #}/Settings/Link01/Enabled</code> Description Toggles the 10GbE link for this AMC13 Valid Values <code>0</code> or <code>1</code> Suggested Value <code>1</code>"},{"location":"odb_config/#amc13-sfp-ip-address","title":"AMC13 SFP IP Address","text":"Field Description Path <code>/Equipment/AMC13{frontend #}/Settings/Link01/AMC13 SFP IP Address</code> Description Specifies the 10GbE link IP Valid Values Any valid IP Suggested Value <code>192.168.50.1</code> <p>Note: This is the AMC13 IP that data is sent over. If this is incorrect, not data will be transferred from the crate. Each frontend (crate) should have a different AMC13 SFP IP address.</p>"},{"location":"odb_config/#amc13-sfp-port-number","title":"AMC13 SFP Port Number","text":"Field Description Path <code>/Equipment/AMC13{frontend #}/Settings/Link01/AMC13 SFP Port Number</code> Description Specifies which SFP port on the AMC13 is used for the 10GbE link Valid Values <code>0x00001234</code>, unsure about others Suggested Value <code>0x00001234</code> <p>Note: <code>0x00001234</code> corresponds to the top port on the AMC13. I would not change this value unless you know what you're doing.</p>"},{"location":"odb_config/#amc13-t1-firmware-version-required","title":"AMC13 T1 Firmware Version Required","text":"Field Description Path <code>/Equipment/AMC13{frontend #}/Settings/AMC13/T1 Firmware Version Required</code> Description The minimum required firmware version for the virtex (T1) FPGA in the AMC13 Valid Values Any positive integer Suggested Value <code>33087</code>"},{"location":"odb_config/#amc13-t2-firmware-version-required","title":"AMC13 T2 Firmware Version Required","text":"Field Description Path <code>/Equipment/AMC13{frontend #}/Settings/AMC13/T2 Firmware Version Required</code> Description The minimum required firmware version for the spartan (T2) FPGA in the AMC13 Valid Values Any positive integer Suggested Value <code>46</code>"},{"location":"odb_config/#amc13-t1-address-table-location","title":"AMC13 T1 Address Table Location","text":"Field Description Path <code>/Equipment/AMC13{frontend #}/Settings/AMC13/T1 Address Table Location</code> Description The path to the AMC13 virtex (T1) adress table xml file Valid Values Any valid path Suggested Value <code>$GM2DAQ_DIR/address_tables/AMC13XG_T1.xml</code>"},{"location":"odb_config/#amc13-t2-address-table-location","title":"AMC13 T2 Address Table Location","text":"Field Description Path <code>/Equipment/AMC13{frontend #}/Settings/AMC13/T2 Address Table Location</code> Description The path to the AMC13 spartan (T2) adress table xml file Valid Values Any valid path Suggested Value <code>$GM2DAQ_DIR/address_tables/AMC13XG_T2.xml</code>"},{"location":"odb_config/#enable-fc7","title":"Enable FC7","text":"Field Description Path <code>/Equipment/AMC13{frontend #}/Settings/FC7-{slot #}/Common/Enabled</code> Description Whether or not this FC7 in the crate is enabled or not Valid Values <code>yes</code> or <code>no</code> Suggested Value <code>yes</code>"},{"location":"odb_config/#fc7-address-table","title":"FC7 Address Table","text":"Field Description Path <code>/Equipment/AMC13{frontend #}/Settings/FC7-{slot #}/Common/Address Table Location</code> Description The path to the FC7 address table xml file Valid Values Any valid path Suggested Value <code>$GM2DAQ_DIR/address_tables/FC7_CCC.xml</code>"},{"location":"odb_config/#fc7-board-type","title":"FC7 Board Type","text":"Field Description Path <code>/Equipment/AMC13{frontend #}/Settings/FC7-{slot #}/Common/Board (encoder,fanout,trigger)</code> Description What job the FC7 is set to do Valid Values <code>encoder</code>,<code>fanout</code>, or <code>trigger</code> Suggested Value <code>encoder</code> <p>Note: The FC7 firmware has been modified so now the <code>encoder</code> FC7 can do the job of the <code>trigger</code> and <code>encoder</code> FC7s.</p>"},{"location":"odb_config/#fc7-firmware-version-required","title":"FC7 Firmware Version Required","text":"Field Description Path <code>/Equipment/AMC13{frontend #}/Settings/FC7-{slot #}/Common/FPGA Firmware Version Required</code> Description The minimum required firmware version for the FC7 Valid Values Any valid string (ex. <code>8.1.7</code>) Suggested Value <code>8.1.7</code>"},{"location":"odb_config/#internal-trigger","title":"Internal Trigger","text":"Field Description Path <code>/Equipment/AMC13{frontend #}/Settings/FC7-{slot #}/Encoder/Internal Trig Enabled</code> Description Whether an external or internal trigger are used to trigger events Valid Values <code>yes</code> or <code>no</code> Suggested Value <code>no</code> <p>Note: This is useful for debugging because it removes the need for having/building an external trigger signal. However, the triggers are periodic so the digitized data will be \"random\" windows of signal or noise.</p>"},{"location":"odb_config/#internal-trigger-period-us","title":"Internal Trigger Period (us)","text":"Field Description Path <code>/Equipment/AMC13{frontend #}/Settings/FC7-{slot #}/Encoder/Internal Trig Period (us)</code> Description The period of the internal trigger in micro seconds Valid Values any positive integer Suggested Value <code>500</code> <p>Note: After each trigger, there is some deadtime. Therefore this value should be longer than the deadtime; otherwise there will be unintended results.</p>"},{"location":"odb_config/#internal-trigger-pulse-width-ns","title":"Internal Trigger Pulse Width (ns)","text":"Field Description Path <code>/Equipment/AMC13{frontend #}/Settings/FC7-{slot #}/Encoder/Internal Pulse Width (ns)</code> Description The width of the internal trigger pulse in nanoseconds Valid Values any positive integer Suggested Value <code>100</code>"},{"location":"odb_config/#ttc-deadtime-ns","title":"TTC deadtime (ns)","text":"Field Description Path <code>/Equipment/AMC13{frontend #}/Settings/FC7-{slot #}/Encoder/TTC deadtime (ns)</code> Description The amount of deadtime (time with no new triggers) after each trigger Valid Values any positive integer Suggested Value <code>100000</code> <p>Note: The achievable rate is limited by this value. For example, if using the suggested value the DAQ cannot trigger at more than 10 kHz.</p>"},{"location":"odb_config/#enabled-wfd5","title":"Enabled WFD5","text":"Field Description Path <code>/Equipment/AMC13{frontend #}/Settings/Rider{slot #}/Board/Address Table Location</code> Description Whether or not this WFD5 is active for data taking Valid Values <code>yes</code> or <code>no</code> Suggested Value <code>yes</code>"},{"location":"odb_config/#wfd5-address-table","title":"WFD5 Address Table","text":"Field Description Path <code>/Equipment/AMC13{frontend #}/Settings/Rider{slot #}/Board/Address Table Location</code> Description The path to the WFD5 address table xml file Valid Values Any valid path Suggested Value <code>$GM2DAQ_DIR/address_tables/WFD5.xml</code>"},{"location":"odb_config/#wfd5-master-firmware-version","title":"WFD5 Master Firmware Version","text":"Field Description Path <code>/Equipment/AMC13{frontend #}/Settings/Rider{slot #}/Board/Master Firmware Version</code> Description Channel Firmware version for the WFD5 Valid Values any valid version string Suggested Value <code>3.1.1</code>"},{"location":"odb_config/#wfd5-channel-firmware-version","title":"WFD5 Channel Firmware Version","text":"Field Description Path <code>/Equipment/AMC13{frontend #}/Settings/Rider{slot #}/Board/Chanel Firmware Version</code> Description Channel Firmware version for the WFD5 Valid Values any valid version string Suggested Value <code>3.1.1</code>"},{"location":"odb_config/#wfd5-digitization-frequency","title":"WFD5 Digitization Frequency","text":"Field Description Path <code>/Equipment/AMC13{frontend #}/Settings/Rider{slot #}/Board/Gitization Frequency (MHz)</code> Description Frequency at which samples are digitized Valid Values <code>800</code> divided by any power of 2 (for example, <code>200</code> is valid) Suggested Value <code>800</code>"},{"location":"odb_config/#wfd5-circular-buffer-mode-enabled","title":"WFD5 Circular Buffer Mode Enabled","text":"Field Description Path <code>/Equipment/AMC13{frontend #}/Settings/Rider{slot #}/Board/CircBuf Mode: Enabled</code> Description Puts a WFD5 into circular buffer mode for data taking Valid Values <code>yes</code> or <code>no</code> Suggested Value <code>yes</code>"},{"location":"odb_config/#wfd5-waveform-length","title":"WFD5 Waveform Length","text":"Field Description Path <code>/Equipment/AMC13{frontend #}/Settings/Rider{slot #}/Board/Async CBuf Waveform Length</code> Description The total number of samples digitized for each waveform trigger Valid Values Any positive integer Suggested Value <code>800</code> <p>Note Each sample corresponds to a time window of 1/Digitization Frequency. So by default each sample corresponds to a 1.25 ns time window.</p>"},{"location":"odb_config/#wfd5-waveform-presamples","title":"WFD5 Waveform Presamples","text":"Field Description Path <code>/Equipment/AMC13{frontend #}/Settings/Rider{slot #}/Board/Async CBuf Waveform Presamples</code> Description How many of the waveform samples are taken before the trigger Valid Values Any positive integer Suggested Value <code>600</code> <p>Note: This value must be less than the value of WFD5 Waveform Length.</p>"},{"location":"odb_config/#wfd5-channel-enabled","title":"WFD5 Channel Enabled","text":"Field Description Path <code>/Equipment/AMC13{frontend #}/Settings/Rider{slot #}/Channel{channel #}/Enabled</code> Description Whether this channel of the WFD5 is enabled for data taking or not Valid Values <code>yes</code> or <code>no</code> Suggested Value <code>yes</code>"},{"location":"odb_config/#tq-methods-gpu-bank-processing","title":"TQ methods GPU Bank Processing","text":"Field Description Path <code>/Equipment/AMC13{frontend #}/Settings/TQ{#}/GlobalParameters/GPU T,Q,P bank processing</code> Description Whether the GPU is used to process this midas bank or not Valid Values <code>yes</code> or <code>no</code> Suggested Value <code>no</code> Field Description Path <code>/Equipment/AMC13{frontend #}/Settings/TQ{#}/GlobalParameters/GPU H bank processing</code> Description Whether the GPU is used to process this midas bank or not Valid Values <code>yes</code> or <code>no</code> Suggested Value <code>no</code> <p>Note: All of the TQ method settings are artifacts of g-2. We just want to make sure they are off.</p>"},{"location":"odb_config/#wfd5-async-mode","title":"WFD5 Async Mode","text":"<p>\"Async Mode\" refers to a mode where each midas event contains 20 traces from each digitizer channel, which may increase the effective data collection rate. However, this mode is currently not working.</p> <p>To turn on async mode set WFD5 Async Mode Enabled (in another place) and TTC Async Mode Enabled to <code>yes</code>. For each digitizer, set WFD5 Async Mode Enabled to <code>yes</code>. Furthermore WFD5 Circular Buffer Mode should be set to <code>no</code>. Otherwise the behavior will be unpredictable. I understand this is a bit convoluted, but this was hastily put together during the 2023 PSI LYSO test beam. There is slightly more documentation on this elog entry.</p>"},{"location":"odb_config/#wfd5-async-mode-enabled","title":"WFD5 Async Mode Enabled","text":"Field Description Path <code>/Equipment/AMC13{frontend #}/Settings/Rider{slot #}/Board/Async Mode: Enabled</code> Description Puts a WFD5 into async mode for data taking Valid Values <code>yes</code> or <code>no</code> Suggested Value <code>no</code>"},{"location":"odb_config/#wfd5-async-mode-enabled-in-another-place","title":"WFD5 Async Mode Enabled (in another place)","text":"Field Description Path <code>/Equipment/AMC13{frontend #}/Settings/FC7-{slot #}/Encoder/WFD5 Async Mode Enabled</code> Description Lets FC7s know WFD5s are in async mode for data taking Valid Values <code>yes</code> or <code>no</code> Suggested Value <code>no</code>"},{"location":"odb_config/#ttc-async-mode-enabled","title":"TTC Async Mode Enabled","text":"Field Description Path <code>/Equipment/AMC13{frontend #}/Settings/FC7-{slot #}/Encoder/TTC Async Mode Enabled</code> Description Puts FC7 into async mode for data taking Valid Values <code>yes</code> or <code>no</code> Suggested Value <code>no</code>"},{"location":"software_add_ons/","title":"Additional Software","text":""},{"location":"software_add_ons/#eigen","title":"Eigen","text":""},{"location":"software_add_ons/#overview","title":"Overview","text":"<p>Eigen is a high-performance C++ library for linear algebra operations, including matrices, vectors, numerical solvers, and related algorithms. It is widely used in various fields such as scientific computing, machine learning, and computer graphics due to its efficiency and ease of use. Eigen provides a wide range of matrix sizes and storage formats, making it versatile for both small and large-scale computations.</p>"},{"location":"software_add_ons/#installation-guide","title":"Installation Guide","text":""},{"location":"software_add_ons/#via-yum-alma9","title":"Via yum (ALMA9)","text":"<pre><code>sudo yum install -y eigen3-devel\n</code></pre>"},{"location":"software_add_ons/#from-source-centos7","title":"From Source (CentOS7)","text":"<pre><code>git clone https://gitlab.com/libeigen/eigen.git\ncd eigen\nmkdir build &amp;&amp; cd build\ncmake ..\nmake\nsudo make install\n</code></pre>"},{"location":"software_add_ons/#midas-event-unpacker","title":"Midas Event Unpacker","text":""},{"location":"software_add_ons/#overview_1","title":"Overview","text":"<p>This is a midas event unpacker used for the g-2 modified DAQ system during the 2023 LYSO test beam, but has seen more development afterwards. The github page has it's own list of instructions for download and use.</p>"},{"location":"software_add_ons/#installation-guide_1","title":"Installation Guide","text":"<p>Follow the instructions on the github page. In particular:</p> <pre><code>git clone --branch develop git@github.com:PIONEER-Experiment/test-beam-2023-unpacker.git unpacker\ncd unpacker\nmkdir build  \ncd build  \ncmake ..\nmake install  \n</code></pre>"},{"location":"software_add_ons/#usage","title":"Usage","text":"<p>Follow the instructions on the github page. In particular run the following command over a generated midas file.</p> <pre><code>./pioneer_unpacker MIDAS_FILE.mid.lz4 0 detector_mapping.json\n</code></pre>"},{"location":"software_add_ons/#publisher","title":"Publisher","text":""},{"location":"software_add_ons/#overview_2","title":"Overview","text":"<p>The publisher is C++ project aimed to publish data over a socket using ZeroMQ. There are two versions:</p> <ol> <li>The General Publisher which is stable and well documented, but does not provide any midas interfacing.</li> <li>The Midas Event Publisher which is less stable and not well document, but does provide midas interfacing.</li> </ol>"},{"location":"software_add_ons/#general-publisher","title":"General Publisher","text":"<p>The general publishing tool is a framework used to publish data over ZeroMQ seemlessly. This tool generally only depends on ZeroMQ and cppZMQ. This branch does not interface with midas at all. However, there is still useful information on this branch about how to configure the publisher and how it works, see the wiki for the publisher.</p>"},{"location":"software_add_ons/#installation-guide_2","title":"Installation Guide","text":"<p>Follow the steps on the wiki.</p>"},{"location":"software_add_ons/#midas-event-publisher","title":"Midas Event Publisher","text":"<p>Warning: This branch was hastefully put together. As a result it is not straightfoward to install and has many issues. Try following this guide first, but if you have issues you can contact the creator (Jack Carlton).</p> <p>This is a different branch of the publisher specialized to using mdump and the midas event unpacker to publish unpacked midas data from a live data run over a socket using zeroMQ. In some cases, we have found that using mdump in this manner lowers the rate capabilites of the DAQ. However, this software is still useful for low rate data quality monitoring.</p> <p>These features are located on the develop branch of the publisher. Which can be installed with the following steps</p>"},{"location":"software_add_ons/#installation-guide_3","title":"Installation Guide","text":"<p>1 Clone the branch</p> <pre><code>git clone -b devel git@github.com:PIONEER-Experiment/midas_publisher.git publisher\ncd publisher\n</code></pre> <p>2 Set up environment</p> <pre><code>./detect_environment.sh\ncat environment_variables.txt\n</code></pre> <p>Ensure each environment variable points to the correct directory. If not, fix it using your favorite text editor. See this example below:</p> <pre><code>MIDASSYS=/home/installation_testing/packages/midas\nMIDAS_EXPTAB=/home/installation_testing/online/exptab\nMIDAS_EXPT_NAME=DAQ\nUNPACKING_ROOT=/home/installation_testing/packages/unpacking\nROOT_ROOT=/home/installation_testing/packages/ROOT\nBOOST_1_70_0_ROOT=/home/installation_testing/packages/boost-1.70.0\nZEROMQ_ROOT=/home/installation_testing/packages/zeroMQ\nCPPZMQ_ROOT=/home/installation_testing/packages/cppzmq\nEIGEN_ROOT=/home/installation_testing/packages/eigen-3.4.0\n</code></pre> <p>Note: <code>BOOST_1_70_0_ROOT</code> is poorly named. This can point to any version of boost past version 1.70.0.</p> <p>Note: If this turns out to be too painful a process, you may find it easier to hardcode CMakeLists.txt. For example, one would find where the CPPZMQ header files are and replace the line <code>$ENV{CPPZMQ_ROOT}/include</code> with a hardcoded path.</p> <pre><code>source ./setup_environment.sh\n</code></pre> <p>3 Build and install</p> <pre><code>cd ..\nmkdir build\ncd build\ncmake ..\nmake install -j$(nproc)\n</code></pre> <p>4 Edit config</p> <p>Edit config.json in your favorite text editor, for instance:</p> <pre><code>cd ..\nvi config.json\n</code></pre> <p>In particular, </p> <pre><code>\"detector-mapping-file\": \"/home/installation_testing/packages/unpacking/python/detector_mapping.json\" \n</code></pre> <p>needs to be set to a valid detector mapping. The unpacking library has one in <code>unpacking/python/detector_mapping.json</code></p> <p>You also may need to change the buffer in</p> <pre><code>\"command\": \"$(MIDASSYS)/bin/mdump -l 1 -z BUF001 -f d\",\n</code></pre> <p>to <code>SYSTEM</code> or whatever buffer you want the publisher to listen to.</p>"},{"location":"software_add_ons/#usage_1","title":"Usage","text":""},{"location":"software_add_ons/#by-hand","title":"\"By Hand\"","text":"<p>Once installed, you can simply run</p> <pre><code>./publisher\n</code></pre> <p>And the publisher will begin. You can increase the <code>verbose</code> setting in <code>config.json</code> to see what it's publishing in real time.</p>"},{"location":"software_add_ons/#cronjob-screen","title":"\"Cronjob\" Screen","text":"<p>In the scripts directory you can start a \"cronjob\" screen that runs the publisher</p> <pre><code>cd scripts\n./screen_publisher_cronjob.sh\n</code></pre> <p>You can stop this screen with </p> <pre><code>./stop_publisher_cronjob_screen.sh\n</code></pre> <p>Note: This isn't really a cronjob, but rather a shell script that periodically kills the publisher and restarts it. There is a memory leak in this branch that hasn't been tracked down, and this is band-aid solution.</p>"},{"location":"software_add_ons/#basic-dqm","title":"Basic DQM","text":""},{"location":"software_add_ons/#overview_3","title":"Overview","text":"<p>This is a \"generalized\" DQM that samples a midas experiment running the g-2 modified DAQ and displays some traces from each active channel. It comes packaged with publisher right now, but may migrate to it's own seperate project. </p>"},{"location":"software_add_ons/#installation-guide_4","title":"Installation Guide","text":"<p>See installation guide for midas event publisher.</p> <p>You also need some python packages:</p> <pre><code>pip install Flask Flask-SocketIO pyzmq\n</code></pre> <p>Note: You may need to use <code>pip3</code> on some systems.</p>"},{"location":"software_add_ons/#usage_2","title":"Usage","text":"<p>The midas event publisher needs to be running for the webpage to get data to display. The webpage will still appear otherwise, but you will not see data incoming. See midas event publisher usage. First, navigate to the publisher root directory. Then</p>"},{"location":"software_add_ons/#by-hand_1","title":"\"By Hand\"","text":"<pre><code>cd dashboard_webpage\npython main.py\n</code></pre> <p>Note: You may need to use <code>python3</code> on some systems.</p> <p>Then open your favorite web browser to <code>localhost:8000</code> to view the webpage.</p>"},{"location":"software_add_ons/#screening-script","title":"Screening Script","text":"<pre><code>cd scripts\n./screen_webpage.sh\n</code></pre> <p>Then open your favorite web browser to <code>localhost:8000</code> to view the webpage.</p> <p>To stop the webpage,</p> <pre><code>./stop_webpage_screen.sh\n</code></pre>"},{"location":"software_add_ons/#crate-monitor","title":"Crate Monitor","text":""},{"location":"software_add_ons/#overview_4","title":"Overview","text":"<p>The crate monitor is a webpage to view the status of g-2 crate components such as the WFD5, FC7, and AMC13. </p>"},{"location":"software_add_ons/#installation-guide_5","title":"Installation Guide","text":"<p>1 Clone the repository</p> <pre><code>git clone git@github.com:PIONEER-Experiment/utcaMonitor.git\n</code></pre> <p>2 Edit run.py</p> <p>In your favorite text editor, edit <code>run.py</code>. For example, with <code>vi</code>:</p> <pre><code>vi run.py\n</code></pre> <p>In particular, change these variables</p> <pre><code># variable defaults\nverbose   = 0\ndebug     = 0\nteststand = 0\nn_crates  = 1\n# amcs in a crate will have ip address 192.168.[crate].[slot]:  Create the default list of n_crate crate numbers\ncrates = [100]\n# types of modules in given crate\namc13100_types = ['FC7','WFD5']\ncrate_types = [amc13100_types]\nencoder_crate = 100\nencoder_slot = 8\n\nhost = 'gm26221.classe.cornell.edu'\n</code></pre> <p>For instance, for a one crate system I used:</p> <pre><code># variable defaults\nverbose   = 0\ndebug     = 0\nteststand = 0\nn_crates  = 1\n# amcs in a crate will have ip address 192.168.[crate].[slot]:  Create the default list of n_crate crate numbers\ncrates = [1]\n# types of modules in given crate\namc13100_types = ['FC7','WFD5']\ncrate_types = [amc13100_types]\nencoder_crate = 1\nencoder_slot = 10\n\nhost = 'localhost'\n</code></pre> <p>3 Run the crate montior</p> <pre><code>python run.py\n</code></pre> <p>Then open <code>localhost:7000</code> in your favorite web browser.</p> <p>Note: You may need to pdate <code>socket.io.min.js</code>. Here's how you do it manually:</p> <p>You may need to update <code>socket.io.min.js</code> (for reasons I'm not entirely sure of). You can get the file on socket io's client installation webpage. Here is a cloudflare link to the version I used; you can copy this to your clipboard</p> <p>Replace the contents of socket.io.min.js in your favorite text editor. For instance in <code>vi</code>:</p> <pre><code>vi utcaMonitor/app/dist/js/socket.io.min.js\n</code></pre> <p>Hit <code>ggdG</code> to erase all lines. Hit <code>i</code> to enter insert mode. <code>Ctrl-V</code> to paste the contents. <code>Esc</code> and <code>:wq</code> to save and exit.</p> <p>After this, rety running the crate monitor.</p>"},{"location":"software_dependencies/","title":"Software Dependencies","text":""},{"location":"software_dependencies/#pioneer-experiment-repositories","title":"PIONEER Experiment Repositories","text":"<p>Access the repositories here: PIONEER Experiment GitHub.</p>"},{"location":"software_dependencies/#contact-for-access","title":"Contact for Access","text":"<p>Patrick Schwendimann:   Email: schwenpa@uw.edu  GitHub: PatrickSchwendimann</p> <p>Joshua Labounty:   Email: jjlab@uw.edu  GitHub: jlabounty</p>"},{"location":"software_dependencies/#setting-up-a-github-ssh-token-on-rhel79-systems","title":"Setting Up a GitHub SSH Token on RHEL7/9 Systems","text":""},{"location":"software_dependencies/#1-generate-an-ssh-key-pair","title":"1. Generate an SSH Key Pair","text":"<ol> <li>Open your terminal.</li> <li> <p>Generate a new SSH key. Replace <code>your_email@example.com</code> with the email address associated with your GitHub account.</p> <p><code>ssh-keygen -t ed25519 -C \"your_email@example.com\"</code></p> <p>If you are using an older system that doesn\u2019t support the <code>ed25519</code> algorithm, you can use <code>rsa</code> instead:</p> <p><code>ssh-keygen -t rsa -b 4096 -C \"your_email@example.com\"</code></p> </li> <li> <p>Follow the prompts to save the key in the default location (<code>~/.ssh/id_ed25519</code>) and set a passphrase.</p> </li> </ol>"},{"location":"software_dependencies/#2-add-the-ssh-key-to-the-ssh-agent","title":"2. Add the SSH Key to the SSH-Agent","text":"<ol> <li> <p>Start the SSH agent in the background:</p> <p><code>eval \"$(ssh-agent -s)\"</code></p> </li> <li> <p>Add your SSH private key to the ssh-agent. Replace <code>id_ed25519</code> with the name of your private key file if you used a different name.</p> <p><code>ssh-add ~/.ssh/id_ed25519</code></p> </li> </ol>"},{"location":"software_dependencies/#3-add-the-ssh-key-to-your-github-account","title":"3. Add the SSH Key to Your GitHub Account","text":"<ol> <li> <p>Copy the SSH key to your clipboard:</p> <p><code>cat ~/.ssh/id_ed25519.pub</code> This will display for the key. Copy all of it.</p> </li> <li> <p>Log in to your GitHub account and navigate to Settings &gt; SSH and GPG keys &gt; New SSH key.</p> </li> <li>Paste your SSH key into the \"Key\" field and add a descriptive title.</li> <li>Click \"Add SSH key\".</li> </ol>"},{"location":"software_dependencies/#4-test-your-ssh-connection","title":"4. Test Your SSH Connection","text":"<ol> <li> <p>Test the connection to make sure everything is set up correctly:</p> <p><code>ssh -T git@github.com</code></p> </li> <li> <p>You should see a message like:</p> <p><code>Hi username! You've successfully authenticated, but GitHub does not provide shell access.</code></p> </li> </ol> <pre><code># Step 1: Generate an SSH Key Pair\nssh-keygen -t ed25519 -C \"your_email@example.com\"\n\n# Step 2: Start the SSH agent in the background\neval \"$(ssh-agent -s)\"\n\n# Step 3: Add your SSH private key to the ssh-agent\nssh-add ~/.ssh/id_ed25519\n\n# Step 4: Copy the SSH key to your clipboard\ncat ~/.ssh/id_ed25519.pub\n\n# Step 5: Add the SSH key to GitHub via the GitHub web interface\n\n# Step 6: Test your SSH connection\nssh -T git@github.com\n</code></pre>"},{"location":"software_dependencies/#example-steps-in-terminal","title":"Example Steps in Terminal","text":""},{"location":"software_dependencies/#development-tools","title":"Development Tools","text":""},{"location":"software_dependencies/#overview","title":"Overview","text":"<p>These tools include compilers, libraries, and other utilities that facilitate software development and installation.</p>"},{"location":"software_dependencies/#installation-guide","title":"Installation Guide","text":"<p>This guide should work for ALMA9. You can use <code>dnf</code> for ALMA9, but I prefer to work with <code>yum</code></p> <p>1 Install yum package manager</p> <pre><code>sudo dnf install yum\n</code></pre> <p>2 Update the package index:</p> <pre><code>sudo yum update\n</code></pre> <p>3 Enable the EPEL repository:</p> <pre><code>sudo yum install epel-release\n</code></pre> <p>4 Install Development Tools and Dependencies:</p> <pre><code>sudo yum groupinstall \"Development Tools\"\nsudo yum install cmake gcc-c++ gcc screen subversion binutils libX11-devel libXpm-devel libXft-devel libXext-devel readline-devel libnsl2-devel pugixml-devel\n</code></pre> <p>Note: Some packages may not be available with <code>yum</code>, but are available with <code>dnf</code>. For example, here's how to install <code>pugixml-devel</code> with <code>dnf</code>:</p> <pre><code>sudo dnf install epel-release\nsudo dnf install pugixml-devel\n</code></pre> <p>Some packages are even more burdensome to install. For example, here's how to install <code>libsnl2-devel</code> with <code>dnf</code>:</p> <pre><code>sudo dnf config-manager --set-enabled crb\nsudo dnf makecache\nsudo dnf install libnsl2-devel\n</code></pre> <p>5 Install Python3</p> <pre><code>sudo yum install python3-devel\n</code></pre>"},{"location":"software_dependencies/#ipmitool","title":"ipmitool","text":""},{"location":"software_dependencies/#overview_1","title":"Overview","text":"<p><code>ipmitool</code> is a widely used command-line utility that facilitates interaction with IPMI-enabled devices. It allows administrators to perform various management tasks remotely and locally. Here's a more detailed look at <code>ipmitool</code>:</p> <ul> <li>Sensor Monitoring: <code>ipmitool</code> can read and display sensor data, such as temperature, voltage, and fan speed, helping to monitor the health and status of the hardware.</li> <li>System Management: It provides commands to control system power states (on, off, reset) and to manage system settings remotely.</li> <li>Firmware Management: <code>ipmitool</code> supports updating and managing firmware of the IPMI-enabled devices.</li> <li>Event Log Management: It can display and clear the system event log (SEL), which records critical system events.</li> <li>Chassis Management: Commands to control and manage the chassis, including power control and identifying LEDs.</li> <li>User Management: Supports adding, modifying, and deleting IPMI users.</li> </ul>"},{"location":"software_dependencies/#installation-guide_1","title":"Installation Guide","text":"<p>1 Install <code>ipmitool</code>:</p> <pre><code>sudo yum install ipmitool\n</code></pre> <p>2 Verify Installation:</p> <pre><code>ipmitool -V\n</code></pre>"},{"location":"software_dependencies/#root","title":"ROOT","text":""},{"location":"software_dependencies/#overview_2","title":"Overview","text":"<p>ROOT is an open-source data analysis framework developed by CERN. It is widely used in high-energy physics for data processing, statistical analysis, visualization, and storage. It is needed for some features of Midas.</p>"},{"location":"software_dependencies/#installation-guide_2","title":"Installation Guide","text":"<p>General installaiton guides are provided by ROOT at their Installing ROOT and Building ROOT from source pages.</p>"},{"location":"software_dependencies/#using-yum-package-manager","title":"Using <code>yum</code> Package Manager","text":"<p>1 Enable the EPEL repository:</p> <pre><code>sudo yum install epel-release\n</code></pre> <p>2 Download and Install ROOT:</p> <pre><code>sudo yum install root\n</code></pre>"},{"location":"software_dependencies/#building-from-source","title":"Building from source","text":"<p>1 Example building latest stable branch from source</p> <pre><code>git clone --branch latest-stable --depth=1 https://github.com/root-project/root.git root_src\nmkdir root_build root_install &amp;&amp; cd root_build\ncmake -DCMAKE_INSTALL_PREFIX=../root_install ../root_src # &amp;&amp; check cmake configuration output for warnings or errors\ncmake --build . -- install -j4 # if you have 4 cores available for compilation\nsource ../root_install/bin/thisroot.sh # or thisroot.{fish,csh}\n</code></pre> <p>Note: Adjust the ROOT version and the download URL as needed. Always check for the latest version on the official ROOT website. Furthermore, if you are not building from source you are installing precompiled binaries, which may not be up to date versions of ROOT. For specific versions, you may need to build root from source.</p>"},{"location":"software_dependencies/#midas","title":"Midas","text":""},{"location":"software_dependencies/#overview_3","title":"Overview","text":"<p>Midas is a data acquisition system used in high-energy physics experiments. Midas provides the following functionalities:</p> <ul> <li>Run control</li> <li>Experiment configuration</li> <li>Data readout</li> <li>Event building</li> <li>Data storage</li> <li>Slow control</li> <li>Alarm systems</li> <li>... much more ...</li> </ul>"},{"location":"software_dependencies/#installation-guide_3","title":"Installation Guide","text":"<p>For a general Midas installation, you can follow this Linux Quick Start Guide. For the g-2 modified DAQ, we use a custom version of midas, which can be cloned and installed as follows:</p> <p>1 Set experiment name environment variable</p> <pre><code>export MIDAS_EXPT_NAME=DAQ\n</code></pre> <p>2 Create exptab file</p> <pre><code>mkdir online\ncd online\ntouch exptab\necho \"$MIDAS_EXPT_NAME $(pwd) system\" &gt;&gt; exptab\nexport MIDAS_EXPTAB=$(pwd)/exptab   \n</code></pre> <p>3 Install Midas</p> <pre><code>cd ..\nmkdir packages\ngit clone --recursive git@github.com:PIONEER-Experiment/midas-modified.git midas\ncd midas\nmkdir build\ncd build\ncmake ..\nmake -j$(nproc) install\ncd ..\n</code></pre> <p>4 Set <code>MIDASSYS</code> environment variable and add to path</p> <pre><code>export MIDASSYS=$(pwd)\nexport PATH=$PATH:$MIDASSYS/bin\n</code></pre> <p>Note: you can hardcode the environment variables <code>MIDASSYS</code> (and add to path), <code>MIDAS_EXPTAB</code>, and <code>MIDAS_EXPT_NAME</code> by adding the appropriate commands to your .bashrc file. This way, the environment variables are set with each new terminal session for that user.</p>"},{"location":"software_dependencies/#boost","title":"Boost","text":""},{"location":"software_dependencies/#overview_4","title":"Overview","text":"<p>Boost is a comprehensive collection of C++ libraries that provide support for various tasks and structures including linear algebra, multithreading, image processing, regex (regular expressions), and more.</p>"},{"location":"software_dependencies/#installation-guide_4","title":"Installation Guide","text":"<p>Boost can be installed on AlmaLinux 9 using package managers or from source. Here are detailed instructions for each method:</p>"},{"location":"software_dependencies/#using-yum-package-manager_1","title":"Using <code>yum</code> Package Manager","text":"<p>1 Install Development Tools and Dependencies:</p> <pre><code>sudo yum groupinstall \"Development Tools\"\nsudo yum install cmake\n</code></pre> <p>2 Install Boost Libraries:</p> <pre><code>sudo yum install epel-release\nsudo yum install boost-devel\n</code></pre>"},{"location":"software_dependencies/#install-boost-176-from-source","title":"Install Boost 1.76 from Source","text":"<p>1 Download and Extract Boost:</p> <pre><code>wget https://sourceforge.net/projects/boost/files/boost/1.76.0/boost_1_76_0.tar.gz\ntar -xzf boost_1_76_0.tar.gz\ncd boost_1_76_0\n</code></pre> <p>2 Configure and Build Boost:</p> <pre><code>./bootstrap.sh --prefix=/usr/local\n./b2\n</code></pre> <p>Replace <code>/usr/local</code> with your desired installation path. Note: You may need to manually link python to boost, to do this:</p> <pre><code>export CPLUS_INCLUDE_PATH=$CPLUS_INCLUDE_PATH:/opt/rh/rh-python36/root/usr/include/python3.6m\n./bootstrap.sh --prefix=/usr/local --with-python=\"/opt/rh/rh-python36/root/usr/bin/python3\" --with-python-root=\"/opt/rh/rh-python36/root\" --with-python-version=\"3.6\"\n</code></pre> <p>where <code>/opt/rh/rh-python36/root/usr/include/python3.6m</code>, <code>/opt/rh/rh-python36/root/usr/bin/python3</code>, <code>/opt/rh/rh-python36/root</code>, and <code>3.6</code> are replaced with the appropriate values for your system.</p> <p>3 Install Boost:</p> <pre><code>./b2 -j$(nproc) install --prefix=/usr/local\n</code></pre> <p>Replace <code>/usr/local</code> with your desired installation path.</p> <p>4 Verify Boost Installation:</p> <pre><code>sudo ldconfig\n</code></pre>"},{"location":"software_dependencies/#ipbus-cactus","title":"IPBus (Cactus)","text":""},{"location":"software_dependencies/#overview_5","title":"Overview","text":"<p>IPBus, part of the Cactus framework, is a protocol for remote control and monitoring of hardware devices over Ethernet. It's commonly used in high-energy DAQ systems.</p>"},{"location":"software_dependencies/#installation-guide_5","title":"Installation Guide","text":"<p>For a general installation guide, see ipbus' Installing the Software page.</p>"},{"location":"software_dependencies/#using-yum-package-manager_2","title":"Using <code>yum</code> Package Manager","text":"<p>1 Remove previous version (if applicable):</p> <pre><code>sudo yum groupremove uhal\n</code></pre> <p>2 Download yum repo file:</p> <pre><code>sudo curl https://ipbus.web.cern.ch/doc/user/html/_downloads/ipbus-sw.el9.repo -o /etc/yum.repos.d/ipbus-sw.repo\n</code></pre> <p>3 Install uHAL:</p> <pre><code>sudo yum clean all\nsudo yum groupinstall uhal\n</code></pre>"},{"location":"software_dependencies/#example-building-from-source","title":"Example building from source","text":"<p>See Compiling and installing from source, an example is below:</p> <pre><code>sudo yum install pugixml-devel\ngit clone --depth=1 -b v2.7.3 --recurse-submodules https://github.com/ipbus/ipbus-software.git\ncd ipbus-software\nmake -j$(nproc) EXTERN_BOOST_INCLUDE_PREFIX=\"/opt/boost/include\" EXTERN_BOOST_LIB_PREFIX=\"/opt/boost/lib\" EXTERN_PUGIXML_INCLUDE_PREFIX=\"/usr/local/include\" EXTERN_PUGIXML_LIB_PREFIX=\"/usr/local/lib64/\"\nsudo make install -j$(nproc)\n</code></pre> <p>Note: You may not need to specify <code>EXTERN_BOOST_INCLUDE_PREFIX</code>, <code>EXTERN_BOOST_LIB_PREFIX</code>, <code>EXTERN_PUGIXML_INCLUDE_PREFIX</code>, <code>EXTERN_PUGIXML_LIB_PREFIX</code>. Otherwise, you may need to find where pugixml and boost were installed and replace the paths above respectively.</p>"},{"location":"software_dependencies/#system-monitor","title":"System Monitor","text":""},{"location":"software_dependencies/#overview_6","title":"Overview","text":"<p>The system monitor software is a custom software package used to attach system resource usage to midas data banks to aid in debugging rate slowdowns. It is a required dependency currently. It's contents can be found in the midas databank <code>SI00</code> where <code>00</code> is replaced with the frontend index. </p>"},{"location":"software_dependencies/#installation-guide_6","title":"Installation Guide","text":"<p>See the github page for more details.</p> <p>1 Clone the repository</p> <pre><code>git clone https://github.com/jaca230/system_diagnostics.git\ncd system_diagnostics\n</code></pre> <p>2 Build the library</p> <pre><code>cd scripts\n./build.sh\n</code></pre> <p>3 Verify installation</p> <pre><code>cd ..\ncd bin\n./system_diagnostics --help\n./system_diagnostics\n</code></pre>"},{"location":"software_dependencies/#meinberg","title":"Meinberg","text":""},{"location":"software_dependencies/#overview_7","title":"Overview","text":"<p>Meinberg provides a range of synchronization solutions, including Network Time Protocol (NTP) servers, precision time protocol (PTP) solutions, and GPS radio clocks. These tools are essential for accurate time synchronization in various high-precision applications.</p> <p>In our case, we use it to apply a GPS timestamp to each event. In reality, this is an artifact from g-2 where seperate systems needed to be time correlated. Only the \"GPS\" master trigger mode needs the meinberg.</p>"},{"location":"software_dependencies/#installation-guide_7","title":"Installation Guide","text":"<p>For more general information about Meinberg devices, see Meinberg's Installing the Software page.</p> <p>1 Clone the repository:</p> <pre><code>git clone https://git.meinbergglobal.com/drivers/mbgtools-lx.git\ncd mbgtools-lx\ngit pull\n</code></pre> <p>Note: Ensure that the URLs and repository paths are correct.</p> <p>2 Compile the source code:</p> <pre><code>make clean\nmake\n</code></pre> <p>Note: You may need to use a development kernel. This command will install the development kernel for your current kernel version.</p> <pre><code>sudo yum install kernel-devel-$(uname -r) gcc make\n</code></pre> <p>3 Install the software:</p> <pre><code>sudo make install\nsudo /sbin/modprobe mbgclock\nmake install_svc\n</code></pre> <p>4 Verify installation</p> <pre><code>mbgstatus\n</code></pre> <p>The output of this command should look similar to this:</p> <pre><code>mbgstatus v4.2.24 copyright Meinberg 2001-2023\n\nTCR180PEX 039212025430 (FW 1.21, ASIC 9.00) at port 0xE000, irq 47\nDate/time:  Tu, 2024-01-30  04:36:10.33 UTC\nSignal: 0%  (IRIG B122/B123, ** UTC offs not configured **)\nStatus info: *** NO INPUT SIGNAL\nStatus info: *** Ref. Time is Invalid\nLast sync:  We, 2023-10-04  11:36:55.00 UTC\n\n** Warning: The IRIG receiver has not yet been configured!\n\nPlease make sure the correct IRIG Code Format has been\nselected, and enter the correct IRIG Time Offset from UTC\naccording to the settings of the IRIG generator.\nThe command \"mbgirigcfg\" can be used to change the settings.\n</code></pre> <p>Note: Check the README in <code>mbgtools-lx</code> which provides step by step debugging for this installation.</p>"}]}